<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The OpSec blog series - E-mail encryption | Valentine's Blog</title><meta name=keywords content="opsec,windows,linux,macos"><meta name=description content="The second post in the OpSec blog series. This one covers e-mail encryption"><meta name=author content="Valentijn Harmers"><link rel=canonical href=https://www.vharmers.com/posts/opsec_mail/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.vharmers.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.vharmers.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.vharmers.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.vharmers.com/apple-touch-icon.png><link rel=mask-icon href=https://www.vharmers.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.vharmers.com/posts/opsec_mail/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.vharmers.com/posts/opsec_mail/"><meta property="og:site_name" content="Valentine's Blog"><meta property="og:title" content="The OpSec blog series - E-mail encryption"><meta property="og:description" content="The second post in the OpSec blog series. This one covers e-mail encryption"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-13T13:47:45+02:00"><meta property="article:modified_time" content="2022-09-13T13:47:45+02:00"><meta property="article:tag" content="Opsec"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Macos"><meta property="og:image" content="https://www.vharmers.com/posts/opsec_mail/posts/opsec_mail/email.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.vharmers.com/posts/opsec_mail/posts/opsec_mail/email.png"><meta name=twitter:title content="The OpSec blog series - E-mail encryption"><meta name=twitter:description content="The second post in the OpSec blog series. This one covers e-mail encryption"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.vharmers.com/posts/"},{"@type":"ListItem","position":2,"name":"The OpSec blog series - E-mail encryption","item":"https://www.vharmers.com/posts/opsec_mail/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The OpSec blog series - E-mail encryption","name":"The OpSec blog series - E-mail encryption","description":"The second post in the OpSec blog series. This one covers e-mail encryption","keywords":["opsec","windows","linux","macos"],"articleBody":"This post is part of a larger series. You can find all posts over here.\nWelcome to the second blog post in this blogging series. I recommend reading the introduction post before starting with this one. Email is one of the oldest ways to communicate on the world wide web. And since the internet was created with openness in mind, so it shouldn’t come as a surprise that e-mail wasn’t designed to be very secure. Sending an e-mail is like sending a postcard. Every party involved in the delivery process can read the contents of the message. From the people working in the distribution centers to the mailman who delivers the card to your door.\nThe solution to this problem is to encrypt your e-mail. This makes the mail unreadable to anyone who is not in possession of the decryption key. You and the recipient(s) of your message will need to install the proper encryption software to handle the encryption and decryption operations. The most popular encryption software choices are OpenPGP and SSL/TLS. I will discuss both choices in the following two sections.\nSSL/TLS Secure Sockets Layer (SSL) and its successor Transport Layer Security (TLS) are encryption protocols. I won’t bore you too much with the technical details, but there is one thing I want to highlight here. It’s not the way the protocol can encrypt and decrypt a message, but the way the sender and receiver of the message can be verified. You see, encryption is fine and all, but it has limited use when there are no guarantees that the recipient of the message is actually the intended recipient. And how can the recipient verify that the message actually came from the listed sender?\nLet’s clarify this problem with a real-world example. In most counties, you are only allowed to drive a car after passing the driving test. Passing the test shows that you have the knowledge and skill to safely drive a car. But how can a police officer verify that you have passed the test? A police officer cannot trust everyone on their word. People can lie after all. The government therefore gives everyone who passes the test a plastic card which acts as proof of their accomplishment. We call his card a driving license.\nWhenever you get pulled over by the police, you can present the officer with your license. The officer might not trust you as an individual, but they will trust the government. There can even be more complex trust relationships. You might get pulled over when on vacation in another country. The police officer does not trust you as a person, but they do trust the authority of their own government, which in turn trusts your own government, which trusts your ability to drive a car.\nSSL and TLS have a similar solution to this problem. There are certificate authorities that can create and distribute certificates to those who need them. A company can act like a certificate authority and provide certificates for all its employees. The employees can use these certificates to verify the identity of each other.\nThe company can also create a trust relationship with a commercial certificate authority, allowing the employees to prove their identity to people outside the company like their customers. This concept is called a “chain of trust”. Everyone trusts the commercial certificate authority, the authority trusts the company and the company trusts its employees.\nThe most popular application for doing everything SSL and TLS related is OpenSSL, but there are also alternative solutions such as LibreSSL, GnuTLS and WolfSSL.\nWarning\nIt’s important to know how the terms SSL and TLS are used. As previously said: TLS is the successor to SSL, but people also use both terms interchangeably. The SSL protocol has been deprecated and should not be used in production environments. So when someone uses the term SSL, they are probably referring to TLS. We nerds don’t like change too much and simply keep using the term SSL, even when the name was changed to TLS. I will just use the term TLS from now on.\nWarning\nYou might stumble on to the term “S/MIME” when doing your own research into mail encryption. S/MIME stands for Secure/Multipurpose Internet Mail Extensions and is a standard for encrypting and singing e-mail messages (MIME data). S/MIME does not do any encryption in and of itself, it simply describes how the encrypted data should be packaged and presented to the receiver of the message. OpenPGP has its own standard for this called OpenPGP/MIME.\nI decided to use the term “TLS” because I wanted to focus on the tools that actually do the encryption and signing operations.\nInfo\nThe cost of certificates can highly differ depending on what your situation is. These are the things you need to think about:\nCertificates come with different assurance levels (also known as classes). There is usually a lower assurance level where only the e-mail address is verified and a higher level where information about the business is also verified. You can get a lower class certificate for around € 20 to € 100 a year (for personal use). A higher one will cost you around a € 50 to € 400 (for business use). Think about how you are going to manage these certificates. Each newly onboarded employee will need their own certificate and you will need to revoke the certificate of every off-boarded employee. Issued certificates will also need to be renewed after a period of 1 to 3 years. OpenPGP PGP stands for Pretty Good Privacy and is the name of an encryption application developed by Phil Zimmermann in the 90s. OpenPGP is an open standard of PGP. This open standard allows others to make their own implementation of PGP. GNU Privacy Guard (abbreviated as GPG or GnuPG) is such an implementation. This application allows you, just like with OpenSSL, to encrypt and decrypt data. One of the biggest differences between TLS and OpenPGP is the way they handle trust relationships.\nTLS works with certificate authorities, creating a chain of trust. The authorities take care of all the complex procedures. You provide them with the necessary information and pay them a fee for their services. The authority will review and confirm the validity of the information and provide you with some kind of proof of identity if everything checks out. But what happens when the authority refuses to give you this proof? There are enough people in this world who cannot leave their county, because their government refuses to provide them with a passport and you can’t cross the border without one.\nOpenPGP makes no use of central authorities. Its users create trust relations between themselves instead. It uses a web of trust instead of a chain of trust. Each user starts with creating a key pair. Each key pair consist out of a public and private key. One key is used to encrypt a message and the other is used to decrypt a previously encrypted message. We call this asymmetric encryption since different keys are used for the encryption and decryption process.\nApart from the key material itself, the public key file also contains information like first- and last name, e-mail address and can even contain a picture of its owner. This public key acts as the user’s proof of identity. It’s then up to the user to get their key certified by other people. These people can be friends, colleagues or other acquaintances. And let’s not forget that this user can also certify the public key of others by using their own private key. This system always reminds me of an advertisement strategy we Dutch people call “Mond tot mond reclame” which translates to: “Mouth to mouth advertising” (I believe this is revered to as “Word of mouth” in the English language).\nIf you are a business owner and deliver a proper product or service to your customers, those customers will recommend your business to their friends. Those friends will then pass the message along and will give the same recommendation to their friends, creating an ever-increasing web of potential customers.\nWhy is nobody using this? You might be thinking: “Nice story and cool software, but I don’t know anyone in my circle of friends who is actually using this nor have I heard any mention about these solutions before”. This is a valid point. Both TLS and OpenPGP have some major drawbacks preventing them from being used on a wide scale for e-mail encryption. TLS is the most user-friendly since most modern e-mail clients such as Outlook, Apple Mail and Thunderbird support it out of the box. The Certificate Authority will also do most of the heavy lifting for you, but they expect to be paid for their services.\nA normal user is not going to pay 40 euro’s a year to get a nice checkmark behind their name. TLS is therefore more popular in corporate environments. Businesses either manage their own certificate authority or let a third party handle this task for them.\nInfo\nMost e-mail applications will display a checkmark behind the sender’s name when the e-mail is digitally signed and successfully verified. Clicking on this checkmark will display some technical information about the sender’s certificate. Here you can see how this looks in Apple Mail on iPadOS:\nThe interface language is in Dutch, but you should still be able to make out some information such as my name (Valentijn Harmers), the name of my employer (NCC Group) and the name of the Certificate Authority who provided the certificate (Entrust, Inc).\nSo TLS is too pricy for non-business users, what about OpenPGP? The software for using OpenPGP is free of charge and it is not customary for users in the web of trust to ask for money in exchange for certifying your key. The problem with OpenPGP lies in its complexity. It puts a lot of responsibility and complexity on the shoulders of its end users. This is too much to ask of your everyday user. It’s therefore only used by geeks and maybe some journalists. There are some graphical interfaces that take away some of the complexity, but it is still a difficult tool to use properly.\nPutting things into practice Let’s leave the theoretical part of this post behind and do something practical. I am going to show you how to use OpenPGP. We are going to generate a key pair and do some stuff with it. Ensure that you have followed the steps in the Introduction post before proceeding with this one.\nInstalling the software We need an application that implements the OpenPGP standard. GnuPG is the best choice. Open up a terminal/Powershell window and type the appropriate command for your system:\nbrew install gpg pinentry-mac # macOS apt install gnupg # Debian/Ubuntu dnf install gnupg2 # Fedora choco install gpg4win # Windows Configuring your system We will need to do some configuration steps before we can proceed with the key pair generation.\nPinentry configuration on macOS Configure GPG to use the pinentry-mac program for entering passwords on a macOS system. This program is preferred over the default pinentry program which is shipped with gpg.\necho \"pinentry-program /usr/local/bin/pinentry-mac\" \u003e\u003e ~/.gnupg/gpg-agent.conf gpgconf --kill gpg-agent Set the GPG_TTY environment variable on Linux and macOS You will need to set and export the GPG_TTY environment variable for the GPG agent on Linux (Debain/Ubuntu/Fedora) and macOS systems:\nGPG_TTY=$(tty) export GPG_TTY It’s best to add these lines to the startup script of your shell. Choose the right command for the shell you are using:\n# Bash shell echo 'export GPG_TTY=$(tty)' \u003e\u003e ~/.bashrc # Zsh shell echo 'export GPG_TTY=$(tty)' \u003e\u003e ~/.zshrc # Fish shell echo 'set -gx GPG_TTY (tty)' \u003e\u003e ~/.config/fish/config.fish Info\nBash is the default shell on most Linux systems. Zsh is the default shell on macOS. You can figure out which shell you are using by running the following command echo \"$SHELL\"\nThis will make sure that the prompt for password entry is displayed in the proper terminal window.\nEnable SSH support for the GPG agent on Linux and macOS (optional) The GPG agent allows you to use your GPG authorization key for SSH access. You can skip this step if you are not interested in using your key for SSH authentication. Follow the following steps to enable it:\nStep 1: Enable SSH support in the agent configuration file:\necho 'enable-ssh-support' \u003e\u003e ~/.gnupg/gpg-agent.conf Step 2: Configure SSH to use the GPG agent for authentication:\n# Bash shell echo 'export SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh' \u003e\u003e ~/.bashrc # zsh shell echo 'export SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh' \u003e\u003e ~/.zshrc # Fish shell echo 'set -gx SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh' \u003e\u003e ~/.config/fish/config.fish Step 3: Restart the agent:\ngpgconf --kill gpg-agent gpgconf --launch gpg-agent Step 4: Close and reopen your terminal. The configured environment variables should now be set (you can check this by running the env command)\nWarning\nThese steps will only work on Linux and macOS systems. Windows users often use applications such as Putty or Kitty to establish SSH connections to Linux servers. I don’t know if this kind of setup is possible with these kind of applications.\nGenerating keys Now it’s time to generate our key pair.\nStep 1: First you will have to generate your master key. The code block below shows the command you need to run in your terminal on the first line. The rest of the lines show the answers to the questions the gpg application will ask. Replace the answers to the ‘Real name’, ‘Email address’ and ‘Comment’ questions with your own information.\ngpg --full-generate-key Your selection? 4 What keysize do you want? (3072) 4096 Key is valid for? (0) 6y Is this correct? (y/N) y Real name: John Doe Email address: john.doe@example.com Comment: John's key Info\nJust like a driver license or passport, a key pair has an expiration date. You are free to choose this date during the creation of your key. The key generated in the code block above, is valid for 6 years. You will have to create a new master key when the old key is about to expire.\nStep 2: Verify the key has been created and note down its ID:\ngpg -K --keyid-format 0xshort /home/john/.gnupg/pubring.kbx ---------------------------------- sec rsa4096/0xFC1B1408 2022-07-07 [SC] [expires: 2028-07-05] 26B6896326F977B6FA0DBE4B1D047E24FC1B1408 uid [ultimate] John Doe (John's key) The code block above shows the command to display the key information. It also shows example output. The key ID in this example is 26B6896326F977B6FA0DBE4B1D047E24FC1B1408 and its short version is 0xFC1B1408. Your own ID will look different. Ensure that you replace 0xFC1B1408 with your own ID in the next steps.\nInfo\nThe created master key allows you to do 2 things:\nCertify other keys. This allows you to create trust relationships with others Digitally sign any file or piece of text Step 3: Add an encryption subkey to your master key:\ngpg --edit-key 0xFC1B1408 gpg\u003e addkey Your selection? 6 Key is valid for? (0) 2y Is this correct? (y/N) y Really create? (y/N) y gpg\u003e save Info\nIt is best practice to create separate key material for signing and encryption purposes. The encryption key can have a shorter expiration date than the master key and can be easily rotated.\nStep 4 (optional): Create a subkey for authentication. You can skip this step if you are not planning to use GPG for SSH access:\ngpg --expert --edit-key 0xFC1B1408 gpg\u003e addkey Your selection? 8 Your selection? A Your selection? S Your selection? E Your selection? Q Key is valid for? (0) 2y Is this correct? (y/N) y Really create? (y/N) y gpg\u003e save Step 5 (optional): Backup your keys. The following command will create backup files in the current working directory:\ngpg --armor --output private.asc --export-secret-key 0xFC1B1408 gpg --armor --output sub_private.asc --export-secret-subkeys 0xFC1B1408 gpg --armor --output public.asc --export 0xFC1B1408 Move these files to a save place. It is recommended to move then to removable storage like a USB stick or CD/DVD. You can also print the keys to paper since they contain plaintext characters.\nStep 6 (optional): Save your public SSH key if you created an authentication key and enabled SSH support:\nssh-add -L \u003e id_rsa.pub You can then copy the contents of the id_rsa.pub file to the systems you need access to.\nCreating trust relationships In order verify signatures or encrypt messages, you will need to import, trust and sign the public keys of others.\nStep 1: Import the key of the person you want to create a trust relationship with. You can import from a file of paste the key directly in to your terminal:\n# Import from file gpg --import public.asc # Paste directly into terminal gpg --import # Then just paste the key and hit the ctrl+d key combo on your keyboard Step 2: Open an edit shell for the newly imported key:\ngpg --edit-key 0x12345678 Replace 0x12345678 with the key id of the imported key from step 1. You can list all key id’s with: gpg -k --keyid-format 0xshort.\nStep 2.1: Trust the key:\ngpg\u003e trust # Please decide how far you trust this user to correctly verify other users' keys # (by looking at passports, checking fingerprints from different sources, etc.) # # 1 = I don't know or won't say # 2 = I do NOT trust # 3 = I trust marginally # 4 = I trust fully # 5 = I trust ultimately # m = back to the main menu # Your decision? 3 Feel free to make a different decision based on your own preference.\nWarning\nEnsure you know that is meant by trust. You don’t decide how far you trust the owner of the key in general. You decide how far you trust the owner to correctly verify the keys of other users.\nStep 2.2: Sign the key with your own key using the lsign or sign command. The following example uses the sign command:\ngpg\u003e sign Really sign? (y/N) y Info\nThe lsign (local sign) command will only keep the generated signature locally. The signature will never be exported or uploaded to a key server. This is handy for when you want to communicate with someone, but do not want to vouch for them in public.\nStep 2.3: Use the save command to save the made changes and close the shell.\nStep 3 (optionally): Share your key signature with the user of the imported key:\ngpg --armor --output public.asc --export 0x12345678 Replace 0x12345678 with the key id of the imported key from step 1. The exported key will include your signature. The owner of the key can then import the updated key in their own keyring.\nInfo\nThe process of transferring, importing and exporting key files can be quite the hassle. You can simplify the process by using a key server. I will explain how to use such a key server in a later section in this blog post.\nUsing your key to sign stuff You can use your key to sign a piece of text or file. Signing provides integrity and nonrepudiation. Any change to the singed content will invalidate the signature. You create the signature with your private key and other people can verify your signatures by using your public key.\nSign and verify a piece of plaintext You can sign a piece of plaintext by following these steps:\nStep 1: Open a terminal or Powershell window and run the following command:\ngpg --armor --clear-sign Step 2: Type or paste your message in the terminal window.\nStep 3: Press ctrl+d to signal GPG that you are done with your message.\nInfo\nThe clear sign option keeps the signed message readable. This allows people to read your message without needing to go through the verification process. Using the sign option will embed the message in the GPG block. Go and see the difference for yourself! Follow the steps again, but replace --clear-sign with --sign.\nYou can verify a piece of text in a similar way. Just replace the command given in Step 1 with:\ngpg --verify Warning\nIf you created a signed message with the --sign option and want verify and read the contents of the message, you will need to use the --decrypt option instead of the --verify option.\nSign and verify a file Signing a file goes a bit differently.\nStep 1: Assuming the file is in the current working directory and is called ‘foo.pdf’:\ngpg --armor --detach-sign foo.pdf This will create a file called ‘foo.pdf.asc’ in the same directory. GPG will save the signature in a binary format if you leave out the --armor option. The signature file will then have the ‘.sig’ extension instead.\nInfo\nGPG saves application output in a binary format by default. The --armor option will order GPG to save the output in a text format instead. Text is easier to work with since it can be placed almost everywhere. You can paste it into an e-mail or a Teams message, host it on a web-site or even print it on a piece of paper if you want to. My recommendation is to use the armor option by default and only leave it out when encrypting files since they can be quite large. Output files created with the armor option enabled will have a ‘.asc’ extension. Binary files will have the ‘.gpg’ or ‘. sig’ extensions.\nStep 2: Verify the file with:\ngpg --verify foo.pdf.asc foo.pdf Info\nUsing the --detach-sign option will cause GPG to save the signature in its own file. This the preferred way of doing it because it keeps the singed file in a readable format. You can also choose to embed the signed file in the signature by using the --sign option instead. And just like with the plaintext singing, you will need to use the --decrypt instead of the --verify option to verify and read the embedded file.\nEncrypting stuff for others Apart from singing text and files, you can also encrypt text and files for others. This functionality ensures confidentiality by making your message only readable for the intended recipients of the message. Ensure you have imported and created trust relationships with the public keys of the recipients of your encrypted message. It is also best practice to sign your encrypted messages, so the recipients can verify that the message came from you.\nSign and encrypt a piece of text The following steps explain how to sign and encrypt a piece of plaintext.\nStep 1: Open a terminal or Powershell window and run the following command:\ngpg --armor --encrypt --sign Step 2: The application will ask you to add the recipients for your message. You can just add them by typing their name or e-mail address. Don’t forget to also add yourself if you also want to be able to decrypt the message.\nStep 3: Type or paste your message.\nStep 4: Press ctrl+d to signal GPG that you are done.\nYou can decrypt the piece of text in a similar way:\nStep 1: Open a terminal or Powershell window and run the following command:\ngpg --decrypt Step 2: Paste the encrypted message in the terminal.\nStep 3: Press the ctrl+d key combination.\nSign and encrypt a file The following steps explain how to sign and encrypt a file.\nStep 1: Assuming the file is in the current working directory and is called ‘foo.pdf’:\ngpg --encrypt --sign foo.pdf Step 2: Add the appropriate recipients. You can just add them by typing their name or e-mail address. Don’t forget to also add yourself if you also want to be able to decrypt the file.\nGPG will save the encrypted file as ‘foo.pdf.gpg’ in the working directory.\nYou can decrypt the file as follows:\ngpg --decrypt foo.pdf.gpg \u003e foo.pdf The decrypted version of the file will be saved as ‘foo.pdf’ in the current working directory.\nUsing a GUI Not a command line warrior? No problem! There are different GUI’s you can use to manage keys and handle signing, verification, encryption and decryption operations. A GUI called ‘Kleopatra’ already ships with the Windows version of GnuPG. Look for its shortcut on your desktop. On Linux systems, you will have to install the ‘kleopatra’ package to get the GUI. GNOME users might want to use the Seahorse GUI instead, since it better blends in with the desktop environment.\nOn macOS you can install GPG Suite if you want a GUI:\nbrew install --cask gpg-suite Warning\nGPG Suite also comes with a plugin for Apple Mail. The plugin comes with a 30 day free trail and will cost you around € 25 afterwards. You can install the ‘gpg-suite-no-mail’ package instead of the ‘gpg-suite’ package if you don’t want the plugin. More on mail client plugins in the next section.\nUsing a mail client plugin Although a bit barbaric, you can just paste the encrypted message in the message body of an e-mail and send it to the intended recipients. Some save the message in a file and add this file as an attachment. This way of working can become quite cumbersome when you have to send a lot of encrypted e-mail and each e-mail has multiple replies you have to read. Luckily there are ways to make your mail client do the heavy lifting. Popular mail clients for Linux systems, such as KMail and Evolution, have builtin support for PGP. Other mail clients will require the installation of a plugin. Here is a list of possible options:\nKMail Builtin support Only available for Linux systems Evolution Builtin support Only available for Linux systems Thunderbird Builtin support since version 78 Available for Windows, macOS and Linux Apple Mail Needs GPG Suite plugin Only available for macOS systems Microsoft Outlook Needs GpgOL plugin, which ships with GnuPG for Windows (so it should be installed already) Available for Windows and macOS systems, but the plugin only works in the Windows version If you prefer a web-interface, you can take a look at Mailvelope. Proton Mail and Tutanota are also good choices if you don’t mind registering a new e-mail address.\nWarning\nLetting your mail client handle the encryption process instead of manually pasting it in the e-mail exposes you to some possible risks you should be aware of:\nA plaintext version of the message might be send on accident, because of a bug in the mail application or plugin The mail application or plugin might not encrypt the concept message. Parts of the message are then leaked to the mail server Modern mail applications use HTML for message composition. These messages have a predictable structure, making them more susceptible to Known Plaintext attacks. Some mail applications allow you to switch to a text format when composing a message Using a key server As described earlier: The process of transferring, importing and exporting key files can be quite the hassle. A key server can make things easier. A key server can be seen as a public repository of keys. You can send your own public key to it and receive the public keys of others. You simply need to know their key ID or e-mail address. I am going to use the key server ‘keys.openpgp.org’ in the following steps.\nStep 1: Export your public key with the usual command: gpg --armor --output public.asc --export 0xFC1B1408. Be sure to replace 0xFC1B1408 with the ID of your own key.\nStep 2: Upload your key using the webform.\nStep 3: Confirm your e-mail address.\nStep 4: Configure ‘keys.openpgp.org’ as your default key server by adding the following line to your ‘gpg.conf’ file:\nkeyserver hkps://keys.openpgp.org The ‘gpg.conf’ file can be found in the ~/.gnupg directory on Linux and macOS systems. On Windows it can be found under %APPDATA%\\gnupg.\nYou can now receive keys in the following way:\n# Receive by e-mail address gpg --auto-key-locate keyserver --locate-keys john.doe@example.com # Receive by short ID gpg --recv-key 0xFC1B1408 # Receive by long ID gpg --recv-key 26B6896326F977B6FA0DBE4B1D047E24FC1B1408 Warning\nThe most reliable way to receive someone’s key is by using the long ID. You can use the short ID if the long one is too much typing work. Retrieving a key based on e-mail address can be tricky. Not all key servers verify the e-mail address that is used with the key.\nStoring your key on a YubiKey Your private key is stored on your systems internal storage by default. This can create problems when a hacker manages to get access to your system. The hacker can steal your private key file which can used to decrypt your messages and sign things in your name. Protecting your private key with a password does help, but a password can just as easily be captured by using a keylogger. The best way to protect your key is to store on a separate hardware device. A YubiKey is a specialized hardware device which can be used to store different types of key material.\nWarning\nEnsure you have generated your keys on a system that you know is not already compromised. You might want to boot into Tails and use it to generate the private key and move the key material to the YubiKey. Don’t forget to make a backup of your private key! You can optionally use the persistent storage feature of Tails to store the backup.\nThe following steps will explain how to move your private key to a YubiKey device:\nStep 1: Buy the key on the website of the manufacturer. You will need a 5 series key.\nStep 2 (optional): Download and install the YubiKey Manager software. There are different ways to do this. You will have 2 options:\nOption 1: Install the platform independent command line Python package. This will require you to install Python and will only give you the command line tool:\n# Install Python3 apt-get install python3 python3-pip # Ubuntu/Debian dnf install python3 python3-pip # Fedora choco install python3 # Windows brew install python3 # macOS # Install Yubikey tools pip3 install --user yubikey-manager Option 2: Download and install the Yubikey Manager software from the Yubico website. This will give you the GUI and command line tool.\nStep 3: Connect the YubiKey to your system.\nStep 4 (optional): Verify that the Yubikey is properly recognized on your system. Use the YubiKey Manager GUI or the ykman list command.\nWarning\nThe ‘ykman’ application should be in your path when you installed the Python version. Look for it in the installation directory if you downloaded the installer from the Yubico website. On macOS it should be in ‘/Applications/YubiKey Manager.app/Contents/MacOS’. On Windows it should be in ‘C:\\Program Files\\Yubico\\YubiKey Manager’ (look for the ‘ykman.exe’ file).\nStep 5: Verify that the YubiKey is recognized by GnuPG by running gpg --card-status in a Terminal or Powershell window.\nWarning\nYou might run into a situation where the YubiKey is recognized by the YubiKey Management software, but it won’t show up in GnuPG. I personally had no problems on Windows, Ubuntu and Fedora but did stumble into this problem on macOS.\nHere is how I fixed it:\nStep 1: Add the following line to your ‘scdaemon.conf’ file:\nreader-port Yubico Yubikey The ‘scdaemon.conf’ file should be in the same directory as your ‘gpg.conf’ file. You might need to create it if it does not exist.\nStep 2: Restart the scdaemon service with gpgconf --reload scdaemon.\nStep 3: The YubiKey should now show up when running the gpg --card-status command.\nStep 6: Prepare the YubiKey for use. The following code block will show you how to do this:\ngpg --card-edit # Should drop you in a gpg shell gpg/card\u003e admin # Unlock admin commands gpg/card\u003e kdf-setup # Extra hardening: Save PIN's as hash instead of plaintext gpg/card\u003e passwd Your selection? 3 # Set an Admin PIN. The default is: '12345678' Your selection? 1 # Set an User PIN. The default is: '123456' Your selection? Q gpg/card\u003e name # Set your name here gpg/card\u003e lang # Configure your preferred language gpg/card\u003e quit The Admin PIN will allow you to administer the device while the User PIN allows you use the device. You will need the Admin PIN to do things like adding or deleting key material while you will use the User PIN for day-to-day tasks.\nInfo\nThe passwd selection menu also allow you to set a Reset PIN. A Reset PIN allows a user to reset their own PIN without needing access to the Admin PIN. The reset PIN is disabled by default. You can leave it disabled if the user and the admin are the same person.\nStep 7 (optional): Configure maximum failed PIN attempts. By default the User and Admin PIN’s will be locked after 3 failed attempts. You can change these values with the YubiKey Manager command line tool:\nykman openpgp access set-retries 5 2 3 The command above will:\nSet the maximum retry attempts for the User PIN to 5 Set the maximum retry attempts for the Reset PIN to 2 Set the maximum retry attempts for the Admin PIN to 3 Feel free to change these values to suit your own preferences.\nStep 8 (optional): Configure require touch. This will require you to touch the key for every GPG operation:\nykman opengpg keys set-touch aut cached ykman opengpg keys set-touch sig cached ykman opengpg keys set-touch enc cached The commands above will configure the Key to require touch for authentication, signing and encryption operations. The action will be remembered for 15 seconds. This ensures the YubiKey will play nice with things like mail client plugins. You might want to set the value to ‘off’ for ‘aut’ if you use things like Ansible. Unless you like touching the YubiKey every 15 seconds during a run, its your party.\nStep 9: Move your master and sub keys to the card. The following code block will show you how to do this:\ngpg --edit-key 0xFC1B1408 gpg\u003e keytocard # Move the master key. Set it as the Signature key gpg\u003e key 1 # Select encryption subkey gpg\u003e keytocard # Move the encryption subkey gpg\u003e key 1 # Deselect encryption subkey gpg\u003e key 2 # Select authentication key. You can skip this step if you don't have one gpg\u003e keytocard # Move the authentication subkey. You can skip this step if you don't have one gpg\u003e save Replace 0xFC1B1408 with the key ID of your own key.\nStep 10: Verify everything is OK. Your key information should now be listed at the bottom when running gpg --card-status.\nStep 11: Try to sign a file or a piece of plaintext. You should get a prompt asking you for your User PIN.\nInfo\nThese steps are based on the steps described in the YubiKey Guide. Check out this guide if you need more detailed information. It also describes things like key rotation. Just be aware that this guide has a different key setup than we have created here. We use the master key to certify other keys and create digital signatures. The YubiKey Guide uses the master key for certification only and uses a separate subkey for singing.\nWarning\nIt’s important to know that YubiKeys won’t prevent hackers from using your private keys, it does prevent them from stealing the keys. A hacker can simply wait for you to plugin and unlock your YubiKey and then start to decrypt and sign stuff, but the hacker will loose access once the YubiKey is pulled from the machine.\nClosing words As you can see from the instructions above, properly setting up mail encryption can be a strait up nightmare for non-technical people. I wouldn’t dare to ask my grandparents nor my parents to set this up. I think this is also the main reason why end-to-end mail encryption will never become mainstream. And this is a problem since new privacy regulations in the EU disallow companies from sending personal information in the clear. This forces companies to limit communications over e-mail. Some have even decided to stop communicating over it altogether.\nAbout a month ago, I wanted to end an insurance contract. I send an e-mail to the insurance company and got an automated reply back instantly. The reply stated that the company had stopped all customer communications over e-mail. I ended up canceling my contract through WhatsApp. Each business ends up with its own solution to the problem. They request you start a chat session on their website or message them through certain chat clients.\nI have also seen some creative solutions. One company had sent me some personal information which was saved in an encrypted PDF attachment, but the password was my zip code, which could be easily bute-forced or obtained with some OSINT work. “The law says we must encrypt all personal information, but nobody said anything about using strong passwords” they must have thought. It made me chuckle a bit.\nThis whole situation saddens me. With e-mail, you have the possibility to freely select your e-mail provider and your e-mail application. You can even become your own provider by setting up a mail server yourself. Most chat platforms don’t give you this kind of freedom. You are forced to use the applications provided by the platform owner and are also forced to send all communications through their systems. This is all fine then the platform is still in the public’s good graces, but things get difficult when it comes into dispute and users want to leave.\nMany experienced this when Facebook took over WhatsApp. People wanted to leave and fled to Signal, but many remained on WhatsApp. All my colleagues and geek friends moved to Signal, while all my family and non-geek friends stayed on WhatsApp. I ended up with both applications installed on my phone. I will be talking more about chat platforms in the next blog post since it will be about this very subject.\n","wordCount":"6278","inLanguage":"en","image":"https://www.vharmers.com/posts/opsec_mail/posts/opsec_mail/email.png","datePublished":"2022-09-13T13:47:45+02:00","dateModified":"2022-09-13T13:47:45+02:00","author":{"@type":"Person","name":"Valentijn Harmers"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vharmers.com/posts/opsec_mail/"},"publisher":{"@type":"Organization","name":"Valentine's Blog","logo":{"@type":"ImageObject","url":"https://www.vharmers.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.vharmers.com/ accesskey=h title="Valentine's Blog (Alt + H)">Valentine's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.vharmers.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://www.vharmers.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.vharmers.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">The OpSec blog series - E-mail encryption</h1><div class=post-description>The second post in the OpSec blog series. This one covers e-mail encryption</div><div class=post-meta><span title='2022-09-13 13:47:45 +0200 +0200'>September 13, 2022</span>&nbsp;·&nbsp;30 min&nbsp;·&nbsp;6278 words&nbsp;·&nbsp;Valentijn Harmers&nbsp;|&nbsp;<a href=https://github.com/vharmers/vharmers.github.io/blob/master/content/posts/opsec_mail.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://www.vharmers.com/posts/opsec_mail/email.png alt=e-mail><figcaption>Image by <a href="https://pixabay.com/nl/users/tumisu-148124/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2362038">Tumisu</a> from <a href="https://pixabay.com/nl//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2362038">Pixabay</a></figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ssltls>SSL/TLS</a></li><li><a href=#openpgp>OpenPGP</a></li><li><a href=#why-is-nobody-using-this>Why is nobody using this?</a></li><li><a href=#putting-things-into-practice>Putting things into practice</a><ul><li><a href=#installing-the-software>Installing the software</a></li><li><a href=#configuring-your-system>Configuring your system</a></li><li><a href=#generating-keys>Generating keys</a></li><li><a href=#creating-trust-relationships>Creating trust relationships</a></li><li><a href=#using-your-key-to-sign-stuff>Using your key to sign stuff</a></li><li><a href=#encrypting-stuff-for-others>Encrypting stuff for others</a></li><li><a href=#using-a-gui>Using a GUI</a></li><li><a href=#using-a-mail-client-plugin>Using a mail client plugin</a></li><li><a href=#using-a-key-server>Using a key server</a></li><li><a href=#storing-your-key-on-a-yubikey>Storing your key on a YubiKey</a></li></ul></li><li><a href=#closing-words>Closing words</a></li></ul></nav></div></details></div><div class=post-content><p><em>This post is part of a larger series. You can find all posts over <a href=https://www.vharmers.com/categories/opsec-series/>here</a></em>.</p><p>Welcome to the second blog post in this blogging series. I recommend reading the introduction post before starting with this one. Email is one of the oldest ways to communicate on the world wide web. And since the internet was created with openness in mind, so it shouldn&rsquo;t come as a surprise that e-mail wasn&rsquo;t designed to be very secure. Sending an e-mail is like sending a postcard. Every party involved in the delivery process can read the contents of the message. From the people working in the distribution centers to the mailman who delivers the card to your door.</p><p>The solution to this problem is to encrypt your e-mail. This makes the mail unreadable to anyone who is not in possession of the decryption key. You and the recipient(s) of your message will need to install the proper encryption software to handle the encryption and decryption operations. The most popular encryption software choices are OpenPGP and SSL/TLS. I will discuss both choices in the following two sections.</p><h2 id=ssltls>SSL/TLS<a hidden class=anchor aria-hidden=true href=#ssltls>#</a></h2><p>Secure Sockets Layer (SSL) and its successor Transport Layer Security (TLS) are encryption protocols. I won&rsquo;t bore you too much with the technical details, but there is one thing I want to highlight here. It&rsquo;s not the way the protocol can encrypt and decrypt a message, but the way the sender and receiver of the message can be verified. You see, encryption is fine and all, but it has limited use when there are no guarantees that the recipient of the message is actually the intended recipient. And how can the recipient verify that the message actually came from the listed sender?</p><p>Let&rsquo;s clarify this problem with a real-world example. In most counties, you are only allowed to drive a car after passing the driving test. Passing the test shows that you have the knowledge and skill to safely drive a car. But how can a police officer verify that you have passed the test? A police officer cannot trust everyone on their word. People can lie after all. The government therefore gives everyone who passes the test a plastic card which acts as proof of their accomplishment. We call his card a driving license.</p><p>Whenever you get pulled over by the police, you can present the officer with your license. The officer might not trust you as an individual, but they will trust the government. There can even be more complex trust relationships. You might get pulled over when on vacation in another country. The police officer does not trust you as a person, but they do trust the authority of their own government, which in turn trusts your own government, which trusts your ability to drive a car.</p><p>SSL and TLS have a similar solution to this problem. There are certificate authorities that can create and distribute certificates to those who need them. A company can act like a certificate authority and provide certificates for all its employees. The employees can use these certificates to verify the identity of each other.</p><p>The company can also create a trust relationship with a commercial certificate authority, allowing the employees to prove their identity to people outside the company like their customers. This concept is called a &ldquo;chain of trust&rdquo;. Everyone trusts the commercial certificate authority, the authority trusts the company and the company trusts its employees.</p><p>The most popular application for doing everything SSL and TLS related is OpenSSL, but there are also alternative solutions such as LibreSSL, GnuTLS and WolfSSL.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>It&rsquo;s important to know how the terms SSL and TLS are used. As previously said: TLS is the successor to SSL, but people also use both terms interchangeably. The SSL protocol has been deprecated and should not be used in production environments. So when someone uses the term SSL, they are probably referring to TLS. We nerds don&rsquo;t like change too much and simply keep using the term SSL, even when the name was changed to TLS. I will just use the term TLS from now on.</p></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>You might stumble on to the term &ldquo;S/MIME&rdquo; when doing your own research into mail encryption. S/MIME stands for <a href=https://en.wikipedia.org/wiki/S/MIME>Secure/Multipurpose Internet Mail Extensions</a> and is a <a href=https://datatracker.ietf.org/doc/html/rfc3851>standard</a> for encrypting and singing e-mail messages (MIME data). S/MIME does not do any encryption in and of itself, it simply describes how the encrypted data should be packaged and presented to the receiver of the message. OpenPGP has its own standard for this called <a href=https://datatracker.ietf.org/doc/html/rfc3156>OpenPGP/MIME</a>.</p><p>I decided to use the term &ldquo;TLS&rdquo; because I wanted to focus on the tools that actually do the encryption and signing operations.</p></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The cost of certificates can highly differ depending on what your situation is. These are the things you need to think about:</p><ul><li>Certificates come with different assurance levels (also known as classes). There is usually a lower assurance level where only the e-mail address is verified and a higher level where information about the business is also verified. You can get a lower class certificate for around € 20 to € 100 a year (for personal use). A higher one will cost you around a € 50 to € 400 (for business use).</li><li>Think about how you are going to manage these certificates. Each newly onboarded employee will need their own certificate and you will need to revoke the certificate of every off-boarded employee. Issued certificates will also need to be renewed after a period of 1 to 3 years.</li></ul></div><h2 id=openpgp>OpenPGP<a hidden class=anchor aria-hidden=true href=#openpgp>#</a></h2><p>PGP stands for Pretty Good Privacy and is the name of an encryption application developed by Phil Zimmermann in the 90s. OpenPGP is an open standard of PGP. This open standard allows others to make their own implementation of PGP. GNU Privacy Guard (abbreviated as GPG or GnuPG) is such an implementation. This application allows you, just like with OpenSSL, to encrypt and decrypt data. One of the biggest differences between TLS and OpenPGP is the way they handle trust relationships.</p><p>TLS works with certificate authorities, creating a chain of trust. The authorities take care of all the complex procedures. You provide them with the necessary information and pay them a fee for their services. The authority will review and confirm the validity of the information and provide you with some kind of proof of identity if everything checks out. But what happens when the authority refuses to give you this proof? There are enough people in this world who cannot leave their county, because their government refuses to provide them with a passport and you can&rsquo;t cross the border without one.</p><p>OpenPGP makes no use of central authorities. Its users create trust relations between themselves instead. It uses a web of trust instead of a chain of trust. Each user starts with creating a key pair. Each key pair consist out of a public and private key. One key is used to encrypt a message and the other is used to decrypt a previously encrypted message. We call this asymmetric encryption since different keys are used for the encryption and decryption process.</p><p>Apart from the key material itself, the public key file also contains information like first- and last name, e-mail address and can even contain a picture of its owner. This public key acts as the user&rsquo;s proof of identity. It&rsquo;s then up to the user to get their key certified by other people. These people can be friends, colleagues or other acquaintances. And let&rsquo;s not forget that this user can also certify the public key of others by using their own private key. This system always reminds me of an advertisement strategy we Dutch people call &ldquo;Mond tot mond reclame&rdquo; which translates to: &ldquo;Mouth to mouth advertising&rdquo; (I believe this is revered to as &ldquo;Word of mouth&rdquo; in the English language).</p><p>If you are a business owner and deliver a proper product or service to your customers, those customers will recommend your business to their friends. Those friends will then pass the message along and will give the same recommendation to their friends, creating an ever-increasing web of potential customers.</p><h2 id=why-is-nobody-using-this>Why is nobody using this?<a hidden class=anchor aria-hidden=true href=#why-is-nobody-using-this>#</a></h2><p>You might be thinking: &ldquo;Nice story and cool software, but I don&rsquo;t know anyone in my circle of friends who is actually using this nor have I heard any mention about these solutions before&rdquo;. This is a valid point. Both TLS and OpenPGP have some major drawbacks preventing them from being used on a wide scale for e-mail encryption. TLS is the most user-friendly since most modern e-mail clients such as Outlook, Apple Mail and Thunderbird support it out of the box. The Certificate Authority will also do most of the heavy lifting for you, but they expect to be paid for their services.</p><p>A normal user is not going to pay 40 euro&rsquo;s a year to get a nice checkmark behind their name. TLS is therefore more popular in corporate environments. Businesses either manage their own certificate authority or let a third party handle this task for them.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>Most e-mail applications will display a checkmark behind the sender&rsquo;s name when the e-mail is digitally signed and successfully verified. Clicking on this checkmark will display some technical information about the sender&rsquo;s certificate. Here you can see how this looks in Apple Mail on iPadOS:</p><p><img alt="S/MIME Mail" loading=lazy src=smime_mail.png></p><p>The interface language is in Dutch, but you should still be able to make out some information such as my name (Valentijn Harmers), the name of my employer (NCC Group) and the name of the Certificate Authority who provided the certificate (Entrust, Inc).</p></div><p>So TLS is too pricy for non-business users, what about OpenPGP? The software for using OpenPGP is free of charge and it is not customary for users in the web of trust to ask for money in exchange for certifying your key. The problem with OpenPGP lies in its complexity. It puts a lot of responsibility and complexity on the shoulders of its end users. This is too much to ask of your everyday user. It&rsquo;s therefore only used by geeks and maybe some journalists. There are some graphical interfaces that take away some of the complexity, but it is still a difficult tool to use properly.</p><h2 id=putting-things-into-practice>Putting things into practice<a hidden class=anchor aria-hidden=true href=#putting-things-into-practice>#</a></h2><p>Let&rsquo;s leave the theoretical part of this post behind and do something practical. I am going to show you how to use OpenPGP. We are going to generate a key pair and do some stuff with it. Ensure that you have followed the steps in the <a href=https://www.vharmers.com/posts/opsec_intro/>Introduction</a> post before proceeding with this one.</p><h3 id=installing-the-software>Installing the software<a hidden class=anchor aria-hidden=true href=#installing-the-software>#</a></h3><p>We need an application that implements the OpenPGP standard. GnuPG is the best choice. Open up a terminal/Powershell window and type the appropriate command for your system:</p><pre tabindex=0><code>brew install gpg pinentry-mac   # macOS
apt install gnupg               # Debian/Ubuntu
dnf install gnupg2              # Fedora
choco install gpg4win           # Windows
</code></pre><h3 id=configuring-your-system>Configuring your system<a hidden class=anchor aria-hidden=true href=#configuring-your-system>#</a></h3><p>We will need to do some configuration steps before we can proceed with the key pair generation.</p><h4 id=pinentry-configuration-on-macos>Pinentry configuration on macOS<a hidden class=anchor aria-hidden=true href=#pinentry-configuration-on-macos>#</a></h4><p>Configure GPG to use the pinentry-mac program for entering passwords on a macOS system. This program is preferred over the default pinentry program which is shipped with gpg.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;pinentry-program /usr/local/bin/pinentry-mac&#34;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpgconf --kill gpg-agent
</span></span></code></pre></div><h4 id=set-the-gpg_tty-environment-variable-on-linux-and-macos>Set the GPG_TTY environment variable on Linux and macOS<a hidden class=anchor aria-hidden=true href=#set-the-gpg_tty-environment-variable-on-linux-and-macos>#</a></h4><p>You will need to set and export the GPG_TTY environment variable for the GPG agent on Linux (Debain/Ubuntu/Fedora) and macOS systems:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GPG_TTY<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>tty<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export GPG_TTY
</span></span></code></pre></div><p>It&rsquo;s best to add these lines to the startup script of your shell. Choose the right command for the shell you are using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Bash shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export GPG_TTY=$(tty)&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Zsh shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export GPG_TTY=$(tty)&#39;</span> &gt;&gt; ~/.zshrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fish shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;set -gx GPG_TTY (tty)&#39;</span> &gt;&gt; ~/.config/fish/config.fish
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>Bash is the default shell on most Linux systems. Zsh is the default shell on macOS. You can figure out which shell you are using by running the following command <code>echo "$SHELL"</code></p></div><p>This will make sure that the prompt for password entry is displayed in the proper terminal window.</p><h4 id=enable-ssh-support-for-the-gpg-agent-on-linux-and-macos-optional>Enable SSH support for the GPG agent on Linux and macOS (optional)<a hidden class=anchor aria-hidden=true href=#enable-ssh-support-for-the-gpg-agent-on-linux-and-macos-optional>#</a></h4><p>The GPG agent allows you to use your GPG authorization key for SSH access. You can skip this step if you are not interested in using your key for SSH authentication. Follow the following steps to enable it:</p><p><strong>Step 1:</strong> Enable SSH support in the agent configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;enable-ssh-support&#39;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf
</span></span></code></pre></div><p><strong>Step 2:</strong> Configure SSH to use the GPG agent for authentication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Bash shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span><span style=color:#75715e># zsh shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh&#39;</span> &gt;&gt; ~/.zshrc
</span></span><span style=display:flex><span><span style=color:#75715e># Fish shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;set -gx SSH_AUTH_SOCK ~/.gnupg/S.gpg-agent.ssh&#39;</span> &gt;&gt; ~/.config/fish/config.fish
</span></span></code></pre></div><p><strong>Step 3:</strong> Restart the agent:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpgconf --kill gpg-agent
</span></span><span style=display:flex><span>gpgconf --launch gpg-agent
</span></span></code></pre></div><p><strong>Step 4:</strong> Close and reopen your terminal. The configured environment variables should now be set (you can check this by running the env command)</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>These steps will only work on Linux and macOS systems. Windows users often use applications such as Putty or Kitty to establish SSH connections to Linux servers. I don&rsquo;t know if this kind of setup is possible with these kind of applications.</p></div><h3 id=generating-keys>Generating keys<a hidden class=anchor aria-hidden=true href=#generating-keys>#</a></h3><p>Now it&rsquo;s time to generate our key pair.</p><p><strong>Step 1:</strong> First you will have to generate your master key. The code block below shows the command you need to run in your terminal on the first line. The rest of the lines show the answers to the questions the gpg application will ask. Replace the answers to the &lsquo;Real name&rsquo;, &lsquo;Email address&rsquo; and &lsquo;Comment&rsquo; questions with your own information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --full-generate-key
</span></span><span style=display:flex><span>Your selection? <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>What keysize <span style=color:#66d9ef>do</span> you want? <span style=color:#f92672>(</span>3072<span style=color:#f92672>)</span> <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>Key is valid <span style=color:#66d9ef>for</span>? <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> 6y
</span></span><span style=display:flex><span>Is this correct? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span>Real name: John Doe
</span></span><span style=display:flex><span>Email address: john.doe@example.com
</span></span><span style=display:flex><span>Comment: John<span style=color:#960050;background-color:#1e0010>&#39;</span>s key
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>Just like a driver license or passport, a key pair has an expiration date. You are free to choose this date during the creation of your key. The key generated in the code block above, is valid for 6 years. You will have to create a new master key when the old key is about to expire.</p></div><p><strong>Step 2:</strong> Verify the key has been created and note down its ID:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg -K --keyid-format 0xshort
</span></span><span style=display:flex><span>/home/john/.gnupg/pubring.kbx
</span></span><span style=display:flex><span>----------------------------------
</span></span><span style=display:flex><span>sec   rsa4096/0xFC1B1408 2022-07-07 <span style=color:#f92672>[</span>SC<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2028-07-05<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      26B6896326F977B6FA0DBE4B1D047E24FC1B1408
</span></span><span style=display:flex><span>uid           <span style=color:#f92672>[</span>ultimate<span style=color:#f92672>]</span> John Doe <span style=color:#f92672>(</span>John<span style=color:#960050;background-color:#1e0010>&#39;</span>s key<span style=color:#f92672>)</span> &lt;john.doe@example.com&gt;
</span></span></code></pre></div><p>The code block above shows the command to display the key information. It also shows example output. The key ID in this example is <code>26B6896326F977B6FA0DBE4B1D047E24FC1B1408</code> and its short version is <code>0xFC1B1408</code>. Your own ID will look different. Ensure that you replace <code>0xFC1B1408</code> with your own ID in the next steps.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The created master key allows you to do 2 things:</p><ul><li>Certify other keys. This allows you to create trust relationships with others</li><li>Digitally sign any file or piece of text</li></ul></div><p><strong>Step 3:</strong> Add an encryption subkey to your master key:</p><pre tabindex=0><code>gpg --edit-key 0xFC1B1408

gpg&gt; addkey
Your selection? 6
Key is valid for? (0) 2y
Is this correct? (y/N) y
Really create? (y/N) y
gpg&gt; save
</code></pre><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>It is best practice to create separate key material for signing and encryption purposes. The encryption key can have a shorter expiration date than the master key and can be easily rotated.</p></div><p><strong>Step 4 (optional):</strong> Create a subkey for authentication. You can skip this step if you are not planning to use GPG for SSH access:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --expert --edit-key 0xFC1B1408
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; addkey
</span></span><span style=display:flex><span>Your selection? <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>Your selection? A
</span></span><span style=display:flex><span>Your selection? S
</span></span><span style=display:flex><span>Your selection? E
</span></span><span style=display:flex><span>Your selection? Q
</span></span><span style=display:flex><span>Key is valid <span style=color:#66d9ef>for</span>? <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> 2y
</span></span><span style=display:flex><span>Is this correct? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span>Really create? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span>gpg&gt; save
</span></span></code></pre></div><p><strong>Step 5 (optional):</strong> Backup your keys. The following command will create backup files in the current working directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --armor --output private.asc --export-secret-key 0xFC1B1408
</span></span><span style=display:flex><span>gpg --armor --output sub_private.asc --export-secret-subkeys 0xFC1B1408
</span></span><span style=display:flex><span>gpg --armor --output public.asc --export 0xFC1B1408
</span></span></code></pre></div><p>Move these files to a save place. It is recommended to move then to removable storage like a USB stick or CD/DVD. You can also print the keys to paper since they contain plaintext characters.</p><p><strong>Step 6 (optional):</strong> Save your public SSH key if you created an authentication key and enabled SSH support:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-add -L &gt; id_rsa.pub
</span></span></code></pre></div><p>You can then copy the contents of the id_rsa.pub file to the systems you need access to.</p><h3 id=creating-trust-relationships>Creating trust relationships<a hidden class=anchor aria-hidden=true href=#creating-trust-relationships>#</a></h3><p>In order verify signatures or encrypt messages, you will need to import, trust and sign the public keys of others.</p><p><strong>Step 1:</strong> Import the key of the person you want to create a trust relationship with. You can import from a file of paste the key directly in to your terminal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Import from file</span>
</span></span><span style=display:flex><span>gpg --import public.asc
</span></span><span style=display:flex><span><span style=color:#75715e># Paste directly into terminal</span>
</span></span><span style=display:flex><span>gpg --import
</span></span><span style=display:flex><span><span style=color:#75715e># Then just paste the key and hit the ctrl+d key combo on your keyboard</span>
</span></span></code></pre></div><p><strong>Step 2:</strong> Open an edit shell for the newly imported key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --edit-key 0x12345678
</span></span></code></pre></div><p>Replace <em>0x12345678</em> with the key id of the imported key from step 1. You can list all key id&rsquo;s with: <code>gpg -k --keyid-format 0xshort</code>.</p><p><strong>Step 2.1:</strong> Trust the key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg&gt; trust
</span></span><span style=display:flex><span><span style=color:#75715e># Please decide how far you trust this user to correctly verify other users&#39; keys</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (by looking at passports, checking fingerprints from different sources, etc.)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  1 = I don&#39;t know or won&#39;t say</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  2 = I do NOT trust</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  3 = I trust marginally</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  4 = I trust fully</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  5 = I trust ultimately</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  m = back to the main menu</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>Your decision? <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>Feel free to make a different decision based on your own preference.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>Ensure you know that is meant by trust. You don&rsquo;t decide how far you trust the owner of the key in general. You decide how far you trust the owner to correctly verify the keys of other users.</p></div><p><strong>Step 2.2:</strong> Sign the key with your own key using the <em>lsign</em> or <em>sign</em> command. The following example uses the <em>sign</em> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg&gt; sign
</span></span><span style=display:flex><span>Really sign? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The lsign (local sign) command will only keep the generated signature locally. The signature will never be exported or uploaded to a key server. This is handy for when you want to communicate with someone, but do not want to vouch for them in public.</p></div><p><strong>Step 2.3:</strong> Use the <em>save</em> command to save the made changes and close the shell.</p><p><strong>Step 3 (optionally):</strong> Share your key signature with the user of the imported key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --armor --output public.asc --export 0x12345678
</span></span></code></pre></div><p>Replace <em>0x12345678</em> with the key id of the imported key from step 1. The exported key will include your signature. The owner of the key can then import the updated key in their own keyring.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The process of transferring, importing and exporting key files can be quite the hassle. You can simplify the process by using a key server. I will explain how to use such a key server in a later section in this blog post.</p></div><h3 id=using-your-key-to-sign-stuff>Using your key to sign stuff<a hidden class=anchor aria-hidden=true href=#using-your-key-to-sign-stuff>#</a></h3><p>You can use your key to sign a piece of text or file. Signing provides integrity and nonrepudiation. Any change to the singed content will invalidate the signature. You create the signature with your private key and other people can verify your signatures by using your public key.</p><h4 id=sign-and-verify-a-piece-of-plaintext>Sign and verify a piece of plaintext<a hidden class=anchor aria-hidden=true href=#sign-and-verify-a-piece-of-plaintext>#</a></h4><p>You can sign a piece of plaintext by following these steps:</p><p><strong>Step 1:</strong> Open a terminal or Powershell window and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --armor --clear-sign
</span></span></code></pre></div><p><strong>Step 2:</strong> Type or paste your message in the terminal window.</p><p><strong>Step 3:</strong> Press ctrl+d to signal GPG that you are done with your message.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The clear sign option keeps the signed message readable. This allows people to read your message without needing to go through the verification process. Using the sign option will embed the message in the GPG block. Go and see the difference for yourself! Follow the steps again, but replace <code>--clear-sign</code> with <code>--sign</code>.</p></div><p>You can verify a piece of text in a similar way. Just replace the command given in Step 1 with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --verify
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>If you created a signed message with the <code>--sign</code> option and want verify and read the contents of the message, you will need to use the <code>--decrypt</code> option instead of the <code>--verify</code> option.</p></div><h4 id=sign-and-verify-a-file>Sign and verify a file<a hidden class=anchor aria-hidden=true href=#sign-and-verify-a-file>#</a></h4><p>Signing a file goes a bit differently.</p><p><strong>Step 1:</strong> Assuming the file is in the current working directory and is called &lsquo;foo.pdf&rsquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --armor --detach-sign foo.pdf
</span></span></code></pre></div><p>This will create a file called &lsquo;foo.pdf.asc&rsquo; in the same directory. GPG will save the signature in a binary format if you leave out the <code>--armor</code> option. The signature file will then have the &lsquo;.sig&rsquo; extension instead.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>GPG saves application output in a binary format by default. The <code>--armor</code> option will order GPG to save the output in a text format instead. Text is easier to work with since it can be placed almost everywhere. You can paste it into an e-mail or a Teams message, host it on a web-site or even print it on a piece of paper if you want to. My recommendation is to use the armor option by default and only leave it out when encrypting files since they can be quite large. Output files created with the armor option enabled will have a &lsquo;.asc&rsquo; extension. Binary files will have the &lsquo;.gpg&rsquo; or &lsquo;. sig&rsquo; extensions.</p></div><p><strong>Step 2:</strong> Verify the file with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --verify foo.pdf.asc foo.pdf
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>Using the <code>--detach-sign</code> option will cause GPG to save the signature in its own file. This the preferred way of doing it because it keeps the singed file in a readable format. You can also choose to embed the signed file in the signature by using the <code>--sign</code> option instead. And just like with the plaintext singing, you will need to use the <code>--decrypt</code> instead of the <code>--verify</code> option to verify and read the embedded file.</p></div><h3 id=encrypting-stuff-for-others>Encrypting stuff for others<a hidden class=anchor aria-hidden=true href=#encrypting-stuff-for-others>#</a></h3><p>Apart from singing text and files, you can also encrypt text and files for others. This functionality ensures confidentiality by making your message only readable for the intended recipients of the message. Ensure you have imported and created trust relationships with the public keys of the recipients of your encrypted message. It is also best practice to sign your encrypted messages, so the recipients can verify that the message came from you.</p><h4 id=sign-and-encrypt-a-piece-of-text>Sign and encrypt a piece of text<a hidden class=anchor aria-hidden=true href=#sign-and-encrypt-a-piece-of-text>#</a></h4><p>The following steps explain how to sign and encrypt a piece of plaintext.</p><p><strong>Step 1:</strong> Open a terminal or Powershell window and run the following command:</p><pre tabindex=0><code>gpg --armor --encrypt --sign
</code></pre><p><strong>Step 2:</strong> The application will ask you to add the recipients for your message. You can just add them by typing their name or e-mail address. Don&rsquo;t forget to also add yourself if you also want to be able to decrypt the message.</p><p><strong>Step 3:</strong> Type or paste your message.</p><p><strong>Step 4:</strong> Press ctrl+d to signal GPG that you are done.</p><p>You can decrypt the piece of text in a similar way:</p><p><strong>Step 1:</strong> Open a terminal or Powershell window and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --decrypt
</span></span></code></pre></div><p><strong>Step 2:</strong> Paste the encrypted message in the terminal.</p><p><strong>Step 3:</strong> Press the ctrl+d key combination.</p><h4 id=sign-and-encrypt-a-file>Sign and encrypt a file<a hidden class=anchor aria-hidden=true href=#sign-and-encrypt-a-file>#</a></h4><p>The following steps explain how to sign and encrypt a file.</p><p><strong>Step 1:</strong> Assuming the file is in the current working directory and is called &lsquo;foo.pdf&rsquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --encrypt --sign foo.pdf
</span></span></code></pre></div><p><strong>Step 2:</strong> Add the appropriate recipients. You can just add them by typing their name or e-mail address. Don&rsquo;t forget to also add yourself if you also want to be able to decrypt the file.</p><p>GPG will save the encrypted file as &lsquo;foo.pdf.gpg&rsquo; in the working directory.</p><p>You can decrypt the file as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --decrypt foo.pdf.gpg &gt; foo.pdf
</span></span></code></pre></div><p>The decrypted version of the file will be saved as &lsquo;foo.pdf&rsquo; in the current working directory.</p><h3 id=using-a-gui>Using a GUI<a hidden class=anchor aria-hidden=true href=#using-a-gui>#</a></h3><p>Not a command line warrior? No problem! There are different GUI&rsquo;s you can use to manage keys and handle signing, verification, encryption and decryption operations. A GUI called &lsquo;Kleopatra&rsquo; already ships with the Windows version of GnuPG. Look for its shortcut on your desktop. On Linux systems, you will have to install the &lsquo;kleopatra&rsquo; package to get the GUI. GNOME users might want to use the Seahorse GUI instead, since it better blends in with the desktop environment.</p><p>On macOS you can install <a href=https://gpgtools.org>GPG Suite</a> if you want a GUI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install --cask gpg-suite
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>GPG Suite also comes with a plugin for Apple Mail. The plugin comes with a 30 day free trail and will cost you around € 25 afterwards. You can install the &lsquo;gpg-suite-no-mail&rsquo; package instead of the &lsquo;gpg-suite&rsquo; package if you don&rsquo;t want the plugin. More on mail client plugins in the next section.</p></div><h3 id=using-a-mail-client-plugin>Using a mail client plugin<a hidden class=anchor aria-hidden=true href=#using-a-mail-client-plugin>#</a></h3><p>Although a bit barbaric, you can just paste the encrypted message in the message body of an e-mail and send it to the intended recipients. Some save the message in a file and add this file as an attachment. This way of working can become quite cumbersome when you have to send a lot of encrypted e-mail and each e-mail has multiple replies you have to read. Luckily there are ways to make your mail client do the heavy lifting. Popular mail clients for Linux systems, such as KMail and Evolution, have builtin support for PGP. Other mail clients will require the installation of a plugin. Here is a list of possible options:</p><ul><li><a href=https://apps.kde.org/kmail2/>KMail</a><ul><li>Builtin support</li><li>Only available for Linux systems</li></ul></li><li><a href=https://wiki.gnome.org/Apps/Evolution>Evolution</a><ul><li>Builtin support</li><li>Only available for Linux systems</li></ul></li><li><a href=https://www.thunderbird.net>Thunderbird</a><ul><li>Builtin support since version 78</li><li>Available for Windows, macOS and Linux</li></ul></li><li>Apple Mail<ul><li>Needs <a href=https://gpgtools.org>GPG Suite</a> plugin</li><li>Only available for macOS systems</li></ul></li><li>Microsoft Outlook<ul><li>Needs GpgOL plugin, which ships with GnuPG for Windows (so it should be installed already)</li><li>Available for Windows and macOS systems, but the plugin only works in the Windows version</li></ul></li></ul><p>If you prefer a web-interface, you can take a look at <a href=https://mailvelope.com/en>Mailvelope</a>. <a href=https://proton.me/mail>Proton Mail</a> and <a href=https://tutanota.com>Tutanota</a> are also good choices if you don&rsquo;t mind registering a new e-mail address.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>Letting your mail client handle the encryption process instead of manually pasting it in the e-mail exposes you to some possible risks you should be aware of:</p><ul><li>A plaintext version of the message might be send on accident, because of a bug in the mail application or plugin</li><li>The mail application or plugin might not encrypt the concept message. Parts of the message are then leaked to the mail server</li><li>Modern mail applications use HTML for message composition. These messages have a predictable structure, making them more susceptible to <a href=https://en.wikipedia.org/wiki/Known-plaintext_attack>Known Plaintext</a> attacks. Some mail applications allow you to switch to a text format when composing a message</li></ul></div><h3 id=using-a-key-server>Using a key server<a hidden class=anchor aria-hidden=true href=#using-a-key-server>#</a></h3><p>As described earlier: The process of transferring, importing and exporting key files can be quite the hassle. A key server can make things easier. A key server can be seen as a public repository of keys. You can send your own public key to it and receive the public keys of others. You simply need to know their key ID or e-mail address. I am going to use the key server &lsquo;keys.openpgp.org&rsquo; in the following steps.</p><p><strong>Step 1:</strong> Export your public key with the usual command: <code>gpg --armor --output public.asc --export 0xFC1B1408</code>. Be sure to replace <em>0xFC1B1408</em> with the ID of your own key.</p><p><strong>Step 2:</strong> Upload your key using the <a href=https://keys.openpgp.org/upload>webform</a>.</p><p><strong>Step 3:</strong> Confirm your e-mail address.</p><p><strong>Step 4:</strong> Configure &lsquo;keys.openpgp.org&rsquo; as your default key server by adding the following line to your &lsquo;gpg.conf&rsquo; file:</p><pre tabindex=0><code>keyserver hkps://keys.openpgp.org
</code></pre><p>The &lsquo;gpg.conf&rsquo; file can be found in the <code>~/.gnupg</code> directory on Linux and macOS systems. On Windows it can be found under <code>%APPDATA%\gnupg</code>.</p><p>You can now receive keys in the following way:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Receive by e-mail address</span>
</span></span><span style=display:flex><span>gpg --auto-key-locate keyserver --locate-keys john.doe@example.com
</span></span><span style=display:flex><span><span style=color:#75715e># Receive by short ID</span>
</span></span><span style=display:flex><span>gpg --recv-key 0xFC1B1408
</span></span><span style=display:flex><span><span style=color:#75715e># Receive by long ID</span>
</span></span><span style=display:flex><span>gpg --recv-key 26B6896326F977B6FA0DBE4B1D047E24FC1B1408
</span></span></code></pre></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>The most reliable way to receive someone&rsquo;s key is by using the long ID. You can use the short ID if the long one is too much typing work. Retrieving a key based on e-mail address can be tricky. Not all key servers verify the e-mail address that is used with the key.</p></div><h3 id=storing-your-key-on-a-yubikey>Storing your key on a YubiKey<a hidden class=anchor aria-hidden=true href=#storing-your-key-on-a-yubikey>#</a></h3><p>Your private key is stored on your systems internal storage by default. This can create problems when a hacker manages to get access to your system. The hacker can steal your private key file which can used to decrypt your messages and sign things in your name. Protecting your private key with a password does help, but a password can just as easily be captured by using a keylogger. The best way to protect your key is to store on a separate hardware device. A YubiKey is a specialized hardware device which can be used to store different types of key material.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>Ensure you have generated your keys on a system that you know is not already compromised. You might want to boot into <a href=https://tails.boum.org>Tails</a> and use it to generate the private key and move the key material to the YubiKey. Don&rsquo;t forget to make a backup of your private key! You can optionally use the <a href=https://tails.boum.org/doc/first_steps/persistence/index.en.html>persistent storage feature</a> of Tails to store the backup.</p></div><p>The following steps will explain how to move your private key to a YubiKey device:</p><p><strong>Step 1:</strong> Buy the key on the <a href=https://www.yubico.com>website</a> of the manufacturer. You will need a <a href=https://www.yubico.com/products/yubikey-5-overview/>5 series</a> key.</p><p><strong>Step 2 (optional):</strong> Download and install the YubiKey Manager software. There are different ways to do this. You will have 2 options:</p><p><em>Option 1:</em> Install the platform independent command line Python package. This will require you to install Python and will only give you the command line tool:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Install Python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apt-get install python3 python3-pip  <span style=color:#75715e># Ubuntu/Debian</span>
</span></span><span style=display:flex><span>dnf install python3 python3-pip  <span style=color:#75715e># Fedora</span>
</span></span><span style=display:flex><span>choco install python3  <span style=color:#75715e># Windows</span>
</span></span><span style=display:flex><span>brew install python3  <span style=color:#75715e># macOS</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Install Yubikey tools</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pip3 install --user yubikey-manager
</span></span></code></pre></div><p><em>Option 2:</em> Download and install the Yubikey Manager software from the Yubico <a href=https://www.yubico.com/support/download/yubikey-manager/>website</a>. This will give you the GUI and command line tool.</p><p><strong>Step 3:</strong> Connect the YubiKey to your system.</p><p><strong>Step 4 (optional):</strong> Verify that the Yubikey is properly recognized on your system. Use the YubiKey Manager GUI or the <code>ykman list</code> command.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>The &lsquo;ykman&rsquo; application should be in your path when you installed the Python version. Look for it in the installation directory if you downloaded the installer from the Yubico website. On macOS it should be in &lsquo;/Applications/YubiKey Manager.app/Contents/MacOS&rsquo;. On Windows it should be in &lsquo;C:\Program Files\Yubico\YubiKey Manager&rsquo; (look for the &lsquo;ykman.exe&rsquo; file).</p></div><p><strong>Step 5:</strong> Verify that the YubiKey is recognized by GnuPG by running <code>gpg --card-status</code> in a Terminal or Powershell window.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>You might run into a situation where the YubiKey is recognized by the YubiKey Management software, but it won&rsquo;t show up in GnuPG. I personally had no problems on Windows, Ubuntu and Fedora but did stumble into this problem on macOS.</p><p>Here is how I fixed it:</p><p><strong>Step 1:</strong> Add the following line to your &lsquo;scdaemon.conf&rsquo; file:</p><pre tabindex=0><code>reader-port Yubico Yubikey
</code></pre><p>The &lsquo;scdaemon.conf&rsquo; file should be in the same directory as your &lsquo;gpg.conf&rsquo; file. You might need to create it if it does not exist.</p><p><strong>Step 2:</strong> Restart the scdaemon service with <code>gpgconf --reload scdaemon</code>.</p><p><strong>Step 3:</strong> The YubiKey should now show up when running the <code>gpg --card-status</code> command.</p></div><p><strong>Step 6:</strong> Prepare the YubiKey for use. The following code block will show you how to do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --card-edit         <span style=color:#75715e># Should drop you in a gpg shell</span>
</span></span><span style=display:flex><span>gpg/card&gt; admin         <span style=color:#75715e># Unlock admin commands</span>
</span></span><span style=display:flex><span>gpg/card&gt; kdf-setup     <span style=color:#75715e># Extra hardening: Save PIN&#39;s as hash instead of plaintext</span>
</span></span><span style=display:flex><span>gpg/card&gt; passwd
</span></span><span style=display:flex><span>Your selection? <span style=color:#ae81ff>3</span>       <span style=color:#75715e># Set an Admin PIN. The default is: &#39;12345678&#39;</span>
</span></span><span style=display:flex><span>Your selection? <span style=color:#ae81ff>1</span>       <span style=color:#75715e># Set an User PIN. The default is: &#39;123456&#39;</span>
</span></span><span style=display:flex><span>Your selection? Q
</span></span><span style=display:flex><span>gpg/card&gt; name          <span style=color:#75715e># Set your name here</span>
</span></span><span style=display:flex><span>gpg/card&gt; lang          <span style=color:#75715e># Configure your preferred language</span>
</span></span><span style=display:flex><span>gpg/card&gt; quit
</span></span></code></pre></div><p>The Admin PIN will allow you to administer the device while the User PIN allows you use the device. You will need the Admin PIN to do things like adding or deleting key material while you will use the User PIN for day-to-day tasks.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>The passwd selection menu also allow you to set a Reset PIN. A Reset PIN allows a user to reset their own PIN without needing access to the Admin PIN. The reset PIN is disabled by default. You can leave it disabled if the user and the admin are the same person.</p></div><p><strong>Step 7 (optional):</strong> Configure maximum failed PIN attempts. By default the User and Admin PIN&rsquo;s will be locked after 3 failed attempts. You can change these values with the YubiKey Manager command line tool:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ykman openpgp access set-retries <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>The command above will:</p><ul><li>Set the maximum retry attempts for the User PIN to 5</li><li>Set the maximum retry attempts for the Reset PIN to 2</li><li>Set the maximum retry attempts for the Admin PIN to 3</li></ul><p>Feel free to change these values to suit your own preferences.</p><p><strong>Step 8 (optional):</strong> Configure require touch. This will require you to touch the key for every GPG operation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ykman opengpg keys set-touch aut cached
</span></span><span style=display:flex><span>ykman opengpg keys set-touch sig cached
</span></span><span style=display:flex><span>ykman opengpg keys set-touch enc cached
</span></span></code></pre></div><p>The commands above will configure the Key to require touch for authentication, signing and encryption operations. The action will be remembered for 15 seconds. This ensures the YubiKey will play nice with things like mail client plugins. You might want to set the value to &lsquo;off&rsquo; for &lsquo;aut&rsquo; if you use things like Ansible. Unless you like touching the YubiKey every 15 seconds during a run, its your party.</p><p><strong>Step 9:</strong> Move your master and sub keys to the card. The following code block will show you how to do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --edit-key 0xFC1B1408
</span></span><span style=display:flex><span>gpg&gt; keytocard  <span style=color:#75715e># Move the master key. Set it as the Signature key</span>
</span></span><span style=display:flex><span>gpg&gt; key <span style=color:#ae81ff>1</span>      <span style=color:#75715e># Select encryption subkey</span>
</span></span><span style=display:flex><span>gpg&gt; keytocard  <span style=color:#75715e># Move the encryption subkey</span>
</span></span><span style=display:flex><span>gpg&gt; key <span style=color:#ae81ff>1</span>      <span style=color:#75715e># Deselect encryption subkey</span>
</span></span><span style=display:flex><span>gpg&gt; key <span style=color:#ae81ff>2</span>      <span style=color:#75715e># Select authentication key. You can skip this step if you don&#39;t have one</span>
</span></span><span style=display:flex><span>gpg&gt; keytocard  <span style=color:#75715e># Move the authentication subkey. You can skip this step if you don&#39;t have one</span>
</span></span><span style=display:flex><span>gpg&gt; save
</span></span></code></pre></div><p>Replace <code>0xFC1B1408</code> with the key ID of your own key.</p><p><strong>Step 10:</strong> Verify everything is OK. Your key information should now be listed at the bottom when running <code>gpg --card-status</code>.</p><p><strong>Step 11:</strong> Try to sign a file or a piece of plaintext. You should get a prompt asking you for your User PIN.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>These steps are based on the steps described in the <a href=https://github.com/drduh/YubiKey-Guide>YubiKey Guide</a>. Check out this guide if you need more detailed information. It also describes things like key rotation. Just be aware that this guide has a different key setup than we have created here. We use the master key to certify other keys and create digital signatures. The YubiKey Guide uses the master key for certification only and uses a separate subkey for singing.</p></div><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}.dark{.notice { --title-color: #fff; --title-background-color: #069; --content-color: #ddd; --content-background-color: #023; } .notice.info { --title-background-color: #a50; --content-background-color: #420; } .notice.tip { --title-background-color: #363; --content-background-color: #121; } .notice.warning { --title-background-color: #800; --content-background-color: #400; }}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>It&rsquo;s important to know that YubiKeys won&rsquo;t prevent hackers from using your private keys, it does prevent them from stealing the keys. A hacker can simply wait for you to plugin and unlock your YubiKey and then start to decrypt and sign stuff, but the hacker will loose access once the YubiKey is pulled from the machine.</p></div><h2 id=closing-words>Closing words<a hidden class=anchor aria-hidden=true href=#closing-words>#</a></h2><p>As you can see from the instructions above, properly setting up mail encryption can be a strait up nightmare for non-technical people. I wouldn&rsquo;t dare to ask my grandparents nor my parents to set this up. I think this is also the main reason why end-to-end mail encryption will never become mainstream. And this is a problem since new privacy regulations in the EU disallow companies from sending personal information in the clear. This forces companies to limit communications over e-mail. Some have even decided to stop communicating over it altogether.</p><p>About a month ago, I wanted to end an insurance contract. I send an e-mail to the insurance company and got an automated reply back instantly. The reply stated that the company had stopped all customer communications over e-mail. I ended up canceling my contract through WhatsApp. Each business ends up with its own solution to the problem. They request you start a chat session on their website or message them through certain chat clients.</p><p>I have also seen some creative solutions. One company had sent me some personal information which was saved in an encrypted PDF attachment, but the password was my zip code, which could be easily bute-forced or obtained with some OSINT work. &ldquo;The law says we must encrypt all personal information, but nobody said anything about using strong passwords&rdquo; they must have thought. It made me chuckle a bit.</p><p>This whole situation saddens me. With e-mail, you have the possibility to freely select your e-mail provider and your e-mail application. You can even become your own provider by setting up a mail server yourself. Most chat platforms don&rsquo;t give you this kind of freedom. You are forced to use the applications provided by the platform owner and are also forced to send all communications through their systems. This is all fine then the platform is still in the public&rsquo;s good graces, but things get difficult when it comes into dispute and users want to leave.</p><p>Many experienced this when Facebook took over WhatsApp. People wanted to leave and fled to Signal, but many remained on WhatsApp. All my colleagues and geek friends moved to Signal, while all my family and non-geek friends stayed on WhatsApp. I ended up with both applications installed on my phone. I will be talking more about chat platforms in the next blog post since it will be about this very subject.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.vharmers.com/tags/opsec/>Opsec</a></li><li><a href=https://www.vharmers.com/tags/windows/>Windows</a></li><li><a href=https://www.vharmers.com/tags/linux/>Linux</a></li><li><a href=https://www.vharmers.com/tags/macos/>Macos</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec blog series - E-mail encryption on x" href="https://x.com/intent/tweet/?text=The%20OpSec%20blog%20series%20-%20E-mail%20encryption&amp;url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_mail%2f&amp;hashtags=opsec%2cwindows%2clinux%2cmacos"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec blog series - E-mail encryption on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_mail%2f&amp;title=The%20OpSec%20blog%20series%20-%20E-mail%20encryption&amp;summary=The%20OpSec%20blog%20series%20-%20E-mail%20encryption&amp;source=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_mail%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec blog series - E-mail encryption on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_mail%2f&title=The%20OpSec%20blog%20series%20-%20E-mail%20encryption"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec blog series - E-mail encryption on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_mail%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.vharmers.com/>Valentine's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>