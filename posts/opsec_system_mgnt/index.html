<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The OpSec Series - System Management | Valentine's Blog</title><meta name=keywords content="opsec,macos,linux,iac"><meta name=description content="The last post in the OpSec series covering System Management with Ansible"><meta name=author content="Valentijn Harmers"><link rel=canonical href=https://www.vharmers.com/posts/opsec_system_mgnt/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.vharmers.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.vharmers.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.vharmers.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.vharmers.com/apple-touch-icon.png><link rel=mask-icon href=https://www.vharmers.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.vharmers.com/posts/opsec_system_mgnt/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.vharmers.com/posts/opsec_system_mgnt/"><meta property="og:site_name" content="Valentine's Blog"><meta property="og:title" content="The OpSec Series - System Management"><meta property="og:description" content="The last post in the OpSec series covering System Management with Ansible"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-22T22:06:28+01:00"><meta property="article:modified_time" content="2024-01-22T22:06:28+01:00"><meta property="article:tag" content="Opsec"><meta property="article:tag" content="Macos"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Iac"><meta property="og:image" content="https://www.vharmers.com/posts/opsec_system_mgnt/posts/opsec_system_mgnt/system_mgnt.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.vharmers.com/posts/opsec_system_mgnt/posts/opsec_system_mgnt/system_mgnt.png"><meta name=twitter:title content="The OpSec Series - System Management"><meta name=twitter:description content="The last post in the OpSec series covering System Management with Ansible"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.vharmers.com/posts/"},{"@type":"ListItem","position":2,"name":"The OpSec Series - System Management","item":"https://www.vharmers.com/posts/opsec_system_mgnt/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The OpSec Series - System Management","name":"The OpSec Series - System Management","description":"The last post in the OpSec series covering System Management with Ansible","keywords":["opsec","macos","linux","iac"],"articleBody":"This post is part of a larger series. You can find all posts over here.\nSetting up systems can be a lengthy and boring process. It is easy to forget a step, execute it in the wrong order or use the wrong settings. I still remember the day when I had to reinstall the Operating System of my laptop on a yearly basis.\nMicrosoft Windows has a tendency to become slower over time. Installing all kinds of software like games and Integrated Development Environments (IDEs) such as Visual Studio and Netbeans also didn’t help. Cleaning tools like CCleaner and Smart Defrag only got you so far. Sometimes the only thing left to do was to reinstall the OS and start fresh.\nThe most annoying part of this process was the installation of the needed applications and their configurations. I had to set the system up how I liked it. “Wouldn’t it be great if could just have a list of applications and settings I could feed to the computer and let it do the heavy lifting for me” I often thought. Little did I know that making these kind of lists would be a large part of my future job.\nOne of the big problems with manually setting up and managing systems is what I would call “system rot”. Changes, like adding and removing users or software or making configuration changes, accumulate over time. It is not always clear who made the change and what its purpose was.\nIt also makes it difficult to recreate a system because it is unclear which changes need to be applied to a base system in order to get the system you had. It’s like assembling a piece of IKEA furniture with no manual. You only get a picture of the already assembled product.\nThis becomes an especially large problem when a system is infected with malware. Trying to remove the malware may be an option but you never if there might be remnants left after the removal attempt. This can cause systems to get reinfected.\nYour second option might be to bring the system back to an uninfected state by restoring a backup. It isn’t always clear when a system got infected however. It would be difficult to determine how far you have to go back to find a clean backup. It isn’t uncommon for attackers to have access to the systems of their victims for months or even years. So you might not have any clean backup to restore.\nThe solution to these problems is to keep track of all changes with a system configuration management tool. This allows you to detect and revert unauthorized changes to a system. There are multiple solutions out there but I have chosen Ansible for this blog post since it is the tool I have the most experience with.\nManaging Systems with Ansible Ansible is an automation solution originally developed by Michael DeHaan and acquired by Red Hat in 2015. The tool is written in the Python programming language and heavily relies on YAML and Jinja2.\nYAML stands for Yet Another Markup Language and is, as the name suggests, a markup language. Markup Languages can be used to write documents that are easy to read for both humans and machines. Other popular languages are XML and JSON. I created a shopping list application, which saves the shopping list in the JSON format, as part of my Python101 tutorial. You can check it out over here.\nJinja2 is a templating engine written in Python. It allows for the use of variables and other functions in Ansible YAML files and system configuration files. Templating is great because it allows you to reuse parts of your code so you don’t have to repeat yourself.\nThere are some Ansible-specific terms you need to know before we can proceed:\nInventory; This is where information about all your Ansible managed systems is stored. The inventory essentially tells Ansible where your systems live. Systems (or hosts) can be organized in groups and configuration can be applied at either host or group level. Task; An action which is carried out on a system. A task could be anything. The creation of a directory or user account, the installation of a software package or the creation of a configuration file. Tasks rely on modules to actually execute the action. Module; Modules are used by tasks to do something, like copying a file. Ansible has a set of builtin modules, but there are also a lot of third-party modules. Ansible’s builtin modules all have the ansible.builtin prefix. Examples include ansible.builtin.copy and ansible.builtin.user. Role; A collection of related tasks. A role can be a collection of tasks for installing and configuring an Nginx Web Server for example. A system or group of systems can have multiple roles assigned to it. Play(book); A play or playbook is essentially a file that defines which Roles should be executed on which systems or groups. There are some other terms that are not mentioned above, but I will introduce them later on. Let’s first look at the smallest element in Ansible:\n- name: Ensure user John Doe exists ansible.builtin.user: name: john.doe groups: - global - accounting - emergency_response The code block above shows the definition of a single task. Each task has a name and makes use of a module to achieve its intended goal. Here we make use of the ansible.builtin.user module to create a user called ‘john.doe’. We also ensure that John is a member of the Global, Accounting and Emergency Response groups. This allows him to access additional files and folders apart from his own private files.\nWe can expand this example by ensuring the groups exist before trying to make John a member of them:\n- name: Ensure the Global group exists ansible.builtin.group: name: global - name: Ensure the Accounting group exists ansible.builtin.group: name: accounting - name: Ensure the Emergency Response group exists ansible.builtin.group: name: emergency_response - name: Ensure user John Doe exists ansible.builtin.user: name: john.doe groups: - global - accounting - emergency_response We now have 4 tasks. 3 for creating groups and 1 for creating a user. We can further optimize the tasks by using loops. This will allow us to merge the 3 group tasks into a single task:\n- name: Ensure groups exists ansible.builtin.group: name: \"{{ item }}\" loop: - global - accounting - emergency_response - name: Ensure user John Doe exists ansible.builtin.user: name: john.doe groups: - global - accounting - emergency_response The new group task will execute the ansible.builtin.group command for each item in the loop list. The {{ item }} placeholder will be replaced with the name current item during a playbook execution. This optimization saves us from having to create tasks for each group we want to create.\nWe now have two tasks we like to run on our systems. Let’s take a look at how we can put these tasks in a role.\nRole structure An Ansible role starts with the following directory structure:\nvharmers.template/ ├── LICENSE ├── README.md ├── defaults │ └── main.yml ├── files │ └── template.bash ├── handlers │ └── main.yml ├── tasks │ ├── configure.yml │ ├── install.yml │ ├── main.yml │ └── validate.yml └── templates ├── template.conf.j2 └── template.service.j2 The figure above shows the directory structure of my own template role. I use this role as a template for creating new roles. The README.md and LICENSE files should be self-explanatory but from there on things start to get interesting:\nDefaults; This folder contains the default variables of this role. These variables can all be overridden in the inventory. I will explain more about variables and the inventory in later sections. Files; This is the location where you put the files you want to use in your role. These files can be anything. You will be able to refer to these files within your tasks. The files in this folder are usually just copied to the target host by using the ansible.builtin.copy module within a task. Handlers; Are special tasks that are triggered by other tasks and run after the normal tasks have been executed. Handlers are used in scenarios where an action only has to be taken when a normal task actually introduces a change in a system. Most popular use cases include the restarting of a service when its configuration file has changed. Tasks; This is where the magic happens. This folder contains the tasks that need to be executed for this role. You can put all of your tasks in a single file but since roles can include a lot of tasks, it is recommended to pull related tasks into separate files to keep things structured. Templates; This folder contains the Jinja2 templates used by the role. These templates can be used the create things like configuration files. Using variables and templates Variables allow us to refer to a value by using a name. Think of it as a shortcut or a reference. A role contains a set of default variables. The values of these variables can be overridden from the inventory. It is easiest to explain by showing an example:\ndefaults/main.yml --- groups: - global - accounting - emergency_response users: - john.doe - jane.doe tasks/main.yml --- - name: Ensure groups exists ansible.builtin.group: name: \"{{ item }}\" loop: \"{{ groups }}\" - name: Ensure users exists ansible.builtin.user: name: \"{{ item }}\" groups: \"{{ groups }}\" loop: \"{{ users }}\" The example above shows the contents of two files (defaults/main.yml and tasks/main.yml). default/main.yml defines two variables called groups and users. The groups variable holds a list of all the groups we need and the users variable holds a list of users who need an account on our systems.\nThese two variables can be used in the tasks/main.yml file to refer to the group and user lists. If we want to add our users to a new group then we can simply add the group to the groups list. This saves us the trouble of having to add the new group at two locations.\nVariables always need to be enclosed with four brackets ({{ groups }}). The brackets tell Ansible, or rather Jinja2, that group is a reference to a variable rather than a normal string. We also need to add quotes to indicate the contents have special meaning and need to be interpreted with Jinja2 which in turn will recognize the variable and replace it with whatever it points to.\nVariables can also be used in templates. Templates are stored in the templates folder. All templates have the “.j2” file extension (j2 is shorthand for jinja2). Here is an example of a template file:\n{% if length(groups) \u003e 0 %} This system has the following groups: {% for group in groups %} - {{ group }} {% endfor %} {% endif %} {% if length(users) \u003e 0 %} This system has the following users: {% for user in users %} - {{ user }} {% endfor %} {% endif %} The template contains some elements that are enclosed with brackets and percent signs ({% ... %}). These differ from the {{ … }} blocks that are used for printing the value of a given variable. The {% ... %} blocks are used for special instructions.\nAt first, we check if the group variable contains any elements. We do this by using the {% if length(groups) \u003e 0 %} statements which roughly translates to “continue if the length of the groups list is greater than zero”. Jinja2 will continue parsing the template if the statement is true. Otherwise, it will skip directly to the {% endif %} block and continue from there.\nThe next thing would be the {% for group in groups %} statement. This simply means: “repeat for every element in the groups variable”. This statement will first retrieve the first element from the groups list, store it in the temporal group variable and continue until it stumbles upon the {% endfor %} block.\nIt will then jump back to the for statement where it will now take the second element in the list, writes its value to the group variable and continues again until it gets to the {% endfor %}. This loop is continued until all the elements in the groups list have had their turn.\nThen we do the same thing for the users variable. Parsing this template with Jinja2 will give you the following result:\nThis system has the following groups: - global - accounting - emergency_response This system has the following users: - john.doe - jane.doe You can parse and copy templates to the targeted system by using the anisble.builtin.template module. Here is an example of a task using this module:\n- name: Ensure configuration is present ansible.builtin.template: src: template.conf.j2 dest: \"{{ template_config_dir }}/template.conf\" owner: \"{{ template_user }}\" group: \"{{ template_group }}\" mode: 0644 notify: Restart service This task takes the template file template.conf.j2 parses it and copies the result to a file called template.conf located in the configuration directory on the targeted system. It then ensures the file has the right owner, group and permissions. The last thing it does is notifying the Restart service handler tasks which in turn will restart the appropriate service when all other tasks have been executed.\nInventory Your inventory is simply a list of systems you want to manage with Ansible. You can put all your systems in the same inventory but you can also spread out your systems over multiple inventories. I personally prefer to have separate inventories for testing and production systems.\nInventories can be structured in either the INI or YAML format. Here is an example of an INI inventory:\nfiles.example.com [webservers] web1.example.com web2.example.com web3.example.com [databases] db1.example.com db2.example.com [proxies] proxy1.example.com proxy2.example.com [firewalls] firewall1.example.com firewall2.example.com The example above shows five groups with each group having one to three members. There is also one system which doesn’t belong to any group. Here is an example of the same inventory but then formatted in YAML:\nungrouped: hosts: - files.example.com webservers: hosts: - web1.example.com - web2.example.com - web3.example.com databases: hosts: - db1.example.com - db2.example.com proxies: hosts: - proxy1.example.com - proxy2.example.com firewalls: hosts: - firewall1.example.com - firewall2.example.com You are free to choose which format to use. I would however advise you to choose and stick with one format.\nOnce you have your inventory you can define your playbook. Here is an example playbook:\n- hosts: all roles: - common - hosts: webservers roles: - apache2 - hosts: databases roles: - mariadb - hosts: proxies roles: - tinyproxy - hosts: firewalls roles: - nftables A playbook is simply the glue between the inventory and the roles. It defines which roles should be executed on which systems. The apache2 role is executed on all systems in the webservers group for example. The ‘all’ pattern is used to select all systems in the inventory so the ‘common’ role is executed on all systems.\nThe default variables for the systems in the inventory can be overridden in the playbook by adding a ‘vars’ section like this:\n- hosts: databases roles: - mariadb vars: mariadb_user: admin mariadb_password: password Note that variable names are often prepended with the name of the role they belong to. This is because all roles share the same variable space. This means that roles will override each other’s variables if they use the same variable names.\nA more proper way to override variables is by putting the variables in separate files. You can make folders for each group and create a file called ‘main.yml’ in each folder. Then you can put the override variables in these main YAML files. You need to create the folders in the same directory where the inventory file is located and the names of these folders need to have the same name as the groups you want to override the variables for.\nInstalling Ansible As mentioned earlier, Ansible is written in Python. You therefore will need a Python interpreter installed. Most Linux distributions already come with Python version 3 preinstalled. macOS also has Python installed by default but it is the older version 2. It is recommended to install the newer version 3 through Homebrew:\nbrew install python3 python3-pip Python comes with its own package manager called ‘pip’. You can use it to install Ansible:\npip3 install ansible Some distributions also offer Ansible as a package. You can also install Ansible directly with Homebrew for example:\nbrew install ansible It is hoverer recommended to stick with one strategy. Installing Ansible with the systems package manager as well as pip will end up confusing your system since the same application has been installed twice.\nAnsible is also not available for the Windows Operating System although there is a Python interpreter available for Windows. The application will not run on Windows because it makes use of functions that are only available on Posix-compliant systems like Linux and macOS. A solution to this problem is to run Ansible on top of Windows Subsystem for Linux or Cygwin.\nUsing Ansible Vault As you can see in the earlier code example, we define a mariadb_user and mariadb_password variable. It’s not the best idea to leave passwords in plaintext because inventory files are often kept in version control solutions such as Git. These solutions are not made with access control in mind. Anyone with access to the repository will be able to see the password and use it to log in on the database.\nA solution to this problem is to encrypt the password with Ansible Vault. This solution is built into Ansible and requires no additional software. Ansible Vault can encrypt whole files or strings of text (inline).\nInline encryption is the easiest. Open up a command prompt and execute the following command:\nansible-vault encrypt_string --ask-vault-password --encrypt-vault-id default The tool will prompt you for a vault password used to encrypt the string and will then allow you to type the string to encrypt. Press Crtl+D when you are done typing the string. Ansible Vault will then print the encrypted multiline string. You can paste this string into your YAML file. Here is an example of what this looks like:\n- hosts: databases roles: - mariadb vars: mariadb_user: admin mariadb_password: !vault | $ANSIBLE_VAULT;1.1;AES256 313764333530363435666238313764343063353461613332623538663134663561 34363532303933393261623863663661310a613739316339346432613639383034 363038396634633261343333316466643366336565373335663065656465323166 61340a633039363737383934363439653932626466366665386362616363363639 6439 As you can see, the value of the mariadb_password variable has been replaced with an Ansible Vault encryption block.\nYou might have noticed that apart from the --ask-vault-password option, we also need to supply the --encrypt-vault-id option with the value of default. Ansible Vault allows you to use multiple separate vaults in your inventory. You can for example have a “production” vault for all the production credentials and a “test” vault for all the test credentials. “default” is the name of the standard vault used by Ansible.\nA similar process can be followed to encrypt a whole file:\nansible-vault create --ask-vault-password --encrypt-vault-id default vault.yml You can edit your existing vault file by replacing ‘create’ with ‘edit’ in the command shown above. It is recommended to use placeholder variables when working with vault files. I will show you the contents of a main and vault file to show you what I mean:\nmain.yml --- mariadb_address: localhost mariadb_port: 3306 mariadb_user: admin mariadb_password: \"{{ vault_mariadb_password }}\" vault.yml (decrypted) --- vault_mariadb_password: password This way of working allows you to easily see which variables have been configured without the need to decrypt the vault.yml file. Note that the above example shows you the decrypted version of vault.yml. The encrypted version should look something like this:\n$ANSIBLE_VAULT;1.1;AES256 38396432316565653734316563373234653338616561663263343339373933616238373334333331 6663636437616538336663396564393731623966323037340a376363636438346564306536396539 35646637363039383733353132623062306361633937343561343238616338646637353233386434 3130386433346436340a623266653333373366653530343864333632663233313630613137366133 65633065303434356239643566666236613733316536646630643133646636373437376365346462 3331326361633337653934326361656136656239633230303533 Having to copy and paste the vault password into the terminal window each time you need to use Ansible Vault can be quite a pain. It’s also not wise from a security perspective since you could paste the password into the wrong window by accident. A solution to this problem is to use a password script instead.\nAnsible allows you to supply it with a file path where it should read the password from. You can do this by using the --vault-password-file option instead of the --ask-vault-password option. Here is an example of how to do this:\necho 'password' \u003e default ansible-vault encrypt_string --vault-password-file default --encrypt-vault-id default You can store the password in a plaintext file but Ansible can also work with script. You can easily create a script that prints the password like the following example:\n#!/usr/bin/env bash pass show infra/ansible/vault@default This bash script loads the vault password from Pass. This solution is safer since the password is not saved in plaintext. Don’t forget to give the file execution permissions otherwise Ansible won’t be able to execute it and will interpret it as a plaintext file.\nUsing Pass with Ansible You can also choose to pull credentials from an external source such as the Pass password manager. You can use this by using a lookup plugin. The pass lookup plugin is shipped with Ansible so there is no need to install any additional software.\nHere is an example of how to use it:\nmariadb_user: admin mariadb_password: \"{{ lookup('pass', 'infra/production/admin@db1.example.com') }}\" You can use lookup plugins with the lookup function. The first argument of this function will always be the name of the plugin you wish to use. The rest of the arguments are passed to the plugin.\nAccessing credentials like this can be useful if you want to have access to credentials from multiple tools. You can for example load the credentials into a Bash or Python script in order to connect to the database to do some maintenance work.\nManaging privileges Making changes to an operating system such as Linux or Windows usually requires administrative privileges. You can tell Ansible for which tasks it should use admin privileges by using the become option. Here is an example of what I mean:\n- name: Ensure that the Python package is installed ansible.builtin.package: name: python3 state: present become: yes The become: yes option instructs Ansible to use admin privileges, also referred to as ‘sudo privileges’ in the Linux world, to install the python3 package since a regular user is not allowed to install packages on a system.\nYou will have to ensure that the user account that is used by Ansible has sudo privileges. This can usually be achieved by adding the user to a certain group. Using the sudo command requires the user password by default on many systems. You can supply this password to Ansible by including the --ask-become-pass switch into your playbook command.\nRunning a playbook I have now explained how to set everything up but you might wonder how to actually execute an Ansible playbook run. You can execute a run with the following command:\nansible-playbook --inventory inventory.ini play.yml Here we tell Ansible which inventory and playbook to use for execution. Your roles should be located in a folder called ‘roles’. There is no option to set the roles path from the commandline but you can set a custom role path by using the ansible.cfg configuration file.\nTo do this, simply create a new file called ansible.cfg in your inventory directory with the following content:\nroles_path = $HOME/Documents/ansible-roles Change the path value to any value you would like. You can configure far more things in the configuration file than you can with commandline options. You can generate a full configuration file by using the following command:\nansible-config init --disabled \u003e ansible.cfg Feel free to use this file as a starting point for your own custom configuration. Remove the semicolon in front of a particular option to make it active.\nClosing words There is much more I can tell you about Ansible but I believe this is enough to get you started. This blog post will be the last post of the OpSec Series. It also acts as a bridge to my next series of blog posts which will focus more on Infrastructure as Code (IaC).\nMy goal with this new blog series is to give people a standardized and structured approach for deploying infrastructure in cloud and on-premise environments. I will mainly explain how IaC tools like Ansible, Terraform and Packer work and how they can be used effectively.\nIt has been about a year ago when I started this blog series and it has been an interesting journey. I often overestimated the time I needed to finish a blog post and always wanted them to be as complete as possible. Writing these blog posts has been a good tool to organize my knowledge and experiences. It is something that I want to continue to do.\nI guess that’s all I wanted to say. Have a good day. See you at my blog post series (or not if IaC does not interest you).\n","wordCount":"4107","inLanguage":"en","image":"https://www.vharmers.com/posts/opsec_system_mgnt/posts/opsec_system_mgnt/system_mgnt.png","datePublished":"2024-01-22T22:06:28+01:00","dateModified":"2024-01-22T22:06:28+01:00","author":{"@type":"Person","name":"Valentijn Harmers"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vharmers.com/posts/opsec_system_mgnt/"},"publisher":{"@type":"Organization","name":"Valentine's Blog","logo":{"@type":"ImageObject","url":"https://www.vharmers.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.vharmers.com/ accesskey=h title="Valentine's Blog (Alt + H)">Valentine's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.vharmers.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://www.vharmers.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.vharmers.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">The OpSec Series - System Management</h1><div class=post-description>The last post in the OpSec series covering System Management with Ansible</div><div class=post-meta><span title='2024-01-22 22:06:28 +0100 +0100'>January 22, 2024</span>&nbsp;·&nbsp;20 min&nbsp;·&nbsp;4107 words&nbsp;·&nbsp;Valentijn Harmers&nbsp;|&nbsp;<a href=https://github.com/vharmers/vharmers.github.io/blob/master/content/posts/opsec_system_mgnt.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://www.vharmers.com/posts/opsec_system_mgnt/system_mgnt.png alt="system management"><figcaption>Image by <a href="https://pixabay.com/users/gthemesh-12784768/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4342425">gTheMesh</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4342425">Pixabay</a></figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#managing-systems-with-ansible>Managing Systems with Ansible</a></li><li><a href=#role-structure>Role structure</a></li><li><a href=#using-variables-and-templates>Using variables and templates</a></li><li><a href=#inventory>Inventory</a></li><li><a href=#installing-ansible>Installing Ansible</a></li><li><a href=#using-ansible-vault>Using Ansible Vault</a></li><li><a href=#using-pass-with-ansible>Using Pass with Ansible</a></li><li><a href=#managing-privileges>Managing privileges</a></li><li><a href=#running-a-playbook>Running a playbook</a></li><li><a href=#closing-words>Closing words</a></li></ul></nav></div></details></div><div class=post-content><p><em>This post is part of a larger series. You can find all posts over <a href=https://www.vharmers.com/categories/opsec-series/>here</a>.</em></p><p>Setting up systems can be a lengthy and boring process. It is easy to forget a step, execute it in the wrong order or use the wrong settings. I still remember the day when I had to reinstall the Operating System of my laptop on a yearly basis.</p><p>Microsoft Windows has a tendency to become slower over time. Installing all kinds of software like games and Integrated Development Environments (IDEs) such as Visual Studio and Netbeans also didn’t help. Cleaning tools like CCleaner and Smart Defrag only got you so far. Sometimes the only thing left to do was to reinstall the OS and start fresh.</p><p>The most annoying part of this process was the installation of the needed applications and their configurations. I had to set the system up how I liked it. “Wouldn’t it be great if could just have a list of applications and settings I could feed to the computer and let it do the heavy lifting for me” I often thought. Little did I know that making these kind of lists would be a large part of my future job.</p><p>One of the big problems with manually setting up and managing systems is what I would call “system rot”. Changes, like adding and removing users or software or making configuration changes, accumulate over time. It is not always clear who made the change and what its purpose was.</p><p>It also makes it difficult to recreate a system because it is unclear which changes need to be applied to a base system in order to get the system you had. It’s like assembling a piece of IKEA furniture with no manual. You only get a picture of the already assembled product.</p><p>This becomes an especially large problem when a system is infected with malware. Trying to remove the malware may be an option but you never if there might be remnants left after the removal attempt. This can cause systems to get reinfected.</p><p>Your second option might be to bring the system back to an uninfected state by restoring a backup. It isn’t always clear when a system got infected however. It would be difficult to determine how far you have to go back to find a clean backup. It isn’t uncommon for attackers to have access to the systems of their victims for months or even years. So you might not have any clean backup to restore.</p><p>The solution to these problems is to keep track of all changes with a system configuration management tool. This allows you to detect and revert unauthorized changes to a system. There are multiple solutions out there but I have chosen Ansible for this blog post since it is the tool I have the most experience with.</p><h2 id=managing-systems-with-ansible>Managing Systems with Ansible<a hidden class=anchor aria-hidden=true href=#managing-systems-with-ansible>#</a></h2><p>Ansible is an automation solution originally developed by Michael DeHaan and acquired by Red Hat in 2015. The tool is written in the Python programming language and heavily relies on YAML and Jinja2.</p><p>YAML stands for Yet Another Markup Language and is, as the name suggests, a markup language. Markup Languages can be used to write documents that are easy to read for both humans and machines. Other popular languages are XML and JSON. I created a shopping list application, which saves the shopping list in the JSON format, as part of my Python101 tutorial. You can check it out over <a href=https://github.com/vharmers/python101/blob/master/lesson_10/storing_data.md>here</a>.</p><p>Jinja2 is a templating engine written in Python. It allows for the use of variables and other functions in Ansible YAML files and system configuration files. Templating is great because it allows you to reuse parts of your code so you don’t have to repeat yourself.</p><p>There are some Ansible-specific terms you need to know before we can proceed:</p><ul><li><strong>Inventory</strong>; This is where information about all your Ansible managed systems is stored. The inventory essentially tells Ansible where your systems live. Systems (or hosts) can be organized in groups and configuration can be applied at either host or group level.</li><li><strong>Task</strong>; An action which is carried out on a system. A task could be anything. The creation of a directory or user account, the installation of a software package or the creation of a configuration file. Tasks rely on modules to actually execute the action.</li><li><strong>Module</strong>; Modules are used by tasks to do something, like copying a file. Ansible has a set of builtin modules, but there are also a lot of third-party modules. Ansible’s builtin modules all have the <code>ansible.builtin</code> prefix. Examples include <code>ansible.builtin.copy</code> and <code>ansible.builtin.user</code>.</li><li><strong>Role</strong>; A collection of related tasks. A role can be a collection of tasks for installing and configuring an Nginx Web Server for example. A system or group of systems can have multiple roles assigned to it.</li><li><strong>Play(book)</strong>; A play or playbook is essentially a file that defines which Roles should be executed on which systems or groups.</li></ul><p>There are some other terms that are not mentioned above, but I will introduce them later on. Let’s first look at the smallest element in Ansible:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure user John Doe exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.user</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>john.doe</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>emergency_response</span>
</span></span></code></pre></div><p>The code block above shows the definition of a single task. Each task has a name and makes use of a module to achieve its intended goal. Here we make use of the <code>ansible.builtin.user</code> module to create a user called ‘john.doe’. We also ensure that John is a member of the Global, Accounting and Emergency Response groups. This allows him to access additional files and folders apart from his own private files.</p><p>We can expand this example by ensuring the groups exist before trying to make John a member of them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure the Global group exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.group</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure the Accounting group exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.group</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure the Emergency Response group exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.group</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>emergency_response</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure user John Doe exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.user</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>john.doe</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>emergency_response</span>
</span></span></code></pre></div><p>We now have 4 tasks. 3 for creating groups and 1 for creating a user. We can further optimize the tasks by using loops. This will allow us to merge the 3 group tasks into a single task:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure groups exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.group</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;{{ item }}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>loop</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>emergency_response</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure user John Doe exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.user</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>john.doe</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>emergency_response</span>
</span></span></code></pre></div><p>The new group task will execute the <code>ansible.builtin.group</code> command for each item in the loop list. The <code>{{ item }}</code> placeholder will be replaced with the name current item during a playbook execution. This optimization saves us from having to create tasks for each group we want to create.</p><p>We now have two tasks we like to run on our systems. Let’s take a look at how we can put these tasks in a role.</p><h2 id=role-structure>Role structure<a hidden class=anchor aria-hidden=true href=#role-structure>#</a></h2><p>An Ansible role starts with the following directory structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>vharmers.template/
</span></span><span style=display:flex><span>├── LICENSE
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── defaults
</span></span><span style=display:flex><span>│   └── main.yml
</span></span><span style=display:flex><span>├── files
</span></span><span style=display:flex><span>│   └── template.bash
</span></span><span style=display:flex><span>├── handlers
</span></span><span style=display:flex><span>│   └── main.yml
</span></span><span style=display:flex><span>├── tasks
</span></span><span style=display:flex><span>│   ├── configure.yml
</span></span><span style=display:flex><span>│   ├── install.yml
</span></span><span style=display:flex><span>│   ├── main.yml
</span></span><span style=display:flex><span>│   └── validate.yml
</span></span><span style=display:flex><span>└── templates
</span></span><span style=display:flex><span>    ├── template.conf.j2
</span></span><span style=display:flex><span>    └── template.service.j2
</span></span></code></pre></div><p>The figure above shows the directory structure of my own template role. I use this role as a template for creating new roles. The <code>README.md</code> and <code>LICENSE</code> files should be self-explanatory but from there on things start to get interesting:</p><ul><li><strong>Defaults;</strong> This folder contains the default variables of this role. These variables can all be overridden in the inventory. I will explain more about variables and the inventory in later sections.</li><li><strong>Files;</strong> This is the location where you put the files you want to use in your role. These files can be anything. You will be able to refer to these files within your tasks. The files in this folder are usually just copied to the target host by using the <code>ansible.builtin.copy</code> module within a task.</li><li><strong>Handlers;</strong> Are special tasks that are triggered by other tasks and run after the normal tasks have been executed. Handlers are used in scenarios where an action only has to be taken when a normal task actually introduces a change in a system. Most popular use cases include the restarting of a service when its configuration file has changed.</li><li><strong>Tasks;</strong> This is where the magic happens. This folder contains the tasks that need to be executed for this role. You can put all of your tasks in a single file but since roles can include a lot of tasks, it is recommended to pull related tasks into separate files to keep things structured.</li><li><strong>Templates;</strong> This folder contains the Jinja2 templates used by the role. These templates can be used the create things like configuration files.</li></ul><h2 id=using-variables-and-templates>Using variables and templates<a hidden class=anchor aria-hidden=true href=#using-variables-and-templates>#</a></h2><p>Variables allow us to refer to a value by using a name. Think of it as a shortcut or a reference. A role contains a set of default variables. The values of these variables can be overridden from the inventory. It is easiest to explain by showing an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>defaults/main.yml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>global</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>accounting</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>emergency_response</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>users</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>john.doe</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>jane.doe</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>tasks/main.yml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure groups exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.group</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;{{ item }}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>loop</span>: <span style=color:#e6db74>&#34;{{ groups }}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure users exists</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.user</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;{{ item }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groups</span>: <span style=color:#e6db74>&#34;{{ groups }}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>loop</span>: <span style=color:#e6db74>&#34;{{ users }}&#34;</span>
</span></span></code></pre></div><p>The example above shows the contents of two files (<code>defaults/main.yml</code> and <code>tasks/main.yml</code>). <code>default/main.yml</code> defines two variables called <code>groups</code> and <code>users</code>. The groups variable holds a list of all the groups we need and the users variable holds a list of users who need an account on our systems.</p><p>These two variables can be used in the <code>tasks/main.yml</code> file to refer to the group and user lists. If we want to add our users to a new group then we can simply add the group to the <code>groups</code> list. This saves us the trouble of having to add the new group at two locations.</p><p>Variables always need to be enclosed with four brackets (<code>{{ groups }}</code>). The brackets tell Ansible, or rather Jinja2, that <code>group</code> is a reference to a variable rather than a normal string. We also need to add quotes to indicate the contents have special meaning and need to be interpreted with Jinja2 which in turn will recognize the variable and replace it with whatever it points to.</p><p>Variables can also be used in templates. Templates are stored in the templates folder. All templates have the “.j2” file extension (j2 is shorthand for jinja2). Here is an example of a template file:</p><pre tabindex=0><code class=language-jinja2 data-lang=jinja2>{% if length(groups) &gt; 0 %}
This system has the following groups:
{% for group in groups %}
  - {{ group }}
{% endfor %}

{% endif %}
{% if length(users) &gt; 0 %}
This system has the following users:
{% for user in users %}
  - {{ user }}
{% endfor %}

{% endif %}
</code></pre><p>The template contains some elements that are enclosed with brackets and percent signs (<code>{% ... %}</code>). These differ from the <code>{{ … }}</code> blocks that are used for printing the value of a given variable. The <code>{% ... %}</code> blocks are used for special instructions.</p><p>At first, we check if the <code>group</code> variable contains any elements. We do this by using the <code>{% if length(groups) > 0 %}</code> statements which roughly translates to “continue if the length of the groups list is greater than zero”. Jinja2 will continue parsing the template if the statement is true. Otherwise, it will skip directly to the <code>{% endif %}</code> block and continue from there.</p><p>The next thing would be the <code>{% for group in groups %}</code> statement. This simply means: “repeat for every element in the groups variable”. This statement will first retrieve the first element from the <code>groups</code> list, store it in the temporal <code>group</code> variable and continue until it stumbles upon the <code>{% endfor %}</code> block.</p><p>It will then jump back to the for statement where it will now take the second element in the list, writes its value to the <code>group</code> variable and continues again until it gets to the <code>{% endfor %}</code>. This loop is continued until all the elements in the <code>groups</code> list have had their turn.</p><p>Then we do the same thing for the users variable. Parsing this template with Jinja2 will give you the following result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>This system has the following groups:
</span></span><span style=display:flex><span>  - global
</span></span><span style=display:flex><span>  - accounting
</span></span><span style=display:flex><span>  - emergency_response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This system has the following users:
</span></span><span style=display:flex><span>  - john.doe
</span></span><span style=display:flex><span>  - jane.doe
</span></span></code></pre></div><p>You can parse and copy templates to the targeted system by using the <code>anisble.builtin.template</code> module. Here is an example of a task using this module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure configuration is present</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>src</span>: <span style=color:#ae81ff>template.conf.j2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dest</span>: <span style=color:#e6db74>&#34;{{ template_config_dir }}/template.conf&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>owner</span>: <span style=color:#e6db74>&#34;{{ template_user }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#34;{{ template_group }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>0644</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>notify</span>: <span style=color:#ae81ff>Restart service</span>
</span></span></code></pre></div><p>This task takes the template file <code>template.conf.j2</code> parses it and copies the result to a file called <code>template.conf</code> located in the configuration directory on the targeted system. It then ensures the file has the right owner, group and permissions. The last thing it does is notifying the <code>Restart service</code> handler tasks which in turn will restart the appropriate service when all other tasks have been executed.</p><h2 id=inventory>Inventory<a hidden class=anchor aria-hidden=true href=#inventory>#</a></h2><p>Your inventory is simply a list of systems you want to manage with Ansible. You can put all your systems in the same inventory but you can also spread out your systems over multiple inventories. I personally prefer to have separate inventories for testing and production systems.</p><p>Inventories can be structured in either the INI or YAML format. Here is an example of an INI inventory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>files.example.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[webservers]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>web1.example.com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>web2.example.com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>web3.example.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[databases]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>db1.example.com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>db2.example.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[proxies]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>proxy1.example.com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>proxy2.example.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[firewalls]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>firewall1.example.com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>firewall2.example.com</span>
</span></span></code></pre></div><p>The example above shows five groups with each group having one to three members. There is also one system which doesn’t belong to any group. Here is an example of the same inventory but then formatted in YAML:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ungrouped</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>files.example.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>webservers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>web1.example.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>web2.example.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>web3.example.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>databases</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>db1.example.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>db2.example.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>proxies</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>proxy1.example.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>proxy2.example.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>firewalls</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>firewall1.example.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>firewall2.example.com</span>
</span></span></code></pre></div><p>You are free to choose which format to use. I would however advise you to choose and stick with one format.</p><p>Once you have your inventory you can define your playbook. Here is an example playbook:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>all</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>common</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>webservers</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>apache2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>databases</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mariadb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>proxies</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>tinyproxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>firewalls</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>nftables</span>
</span></span></code></pre></div><p>A playbook is simply the glue between the inventory and the roles. It defines which roles should be executed on which systems. The apache2 role is executed on all systems in the webservers group for example. The ‘all’ pattern is used to select all systems in the inventory so the ‘common’ role is executed on all systems.</p><p>The default variables for the systems in the inventory can be overridden in the playbook by adding a ‘vars’ section like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>databases</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mariadb</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vars</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>mariadb_user</span>: <span style=color:#ae81ff>admin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mariadb_password</span>: <span style=color:#ae81ff>password</span>
</span></span></code></pre></div><p>Note that variable names are often prepended with the name of the role they belong to. This is because all roles share the same variable space. This means that roles will override each other&rsquo;s variables if they use the same variable names.</p><p>A more proper way to override variables is by putting the variables in separate files. You can make folders for each group and create a file called ‘main.yml’ in each folder. Then you can put the override variables in these main YAML files. You need to create the folders in the same directory where the inventory file is located and the names of these folders need to have the same name as the groups you want to override the variables for.</p><h2 id=installing-ansible>Installing Ansible<a hidden class=anchor aria-hidden=true href=#installing-ansible>#</a></h2><p>As mentioned earlier, Ansible is written in Python. You therefore will need a Python interpreter installed. Most Linux distributions already come with Python version 3 preinstalled. macOS also has Python installed by default but it is the older version 2. It is recommended to install the newer version 3 through Homebrew:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install python3 python3-pip
</span></span></code></pre></div><p>Python comes with its own package manager called ‘pip’. You can use it to install Ansible:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip3 install ansible
</span></span></code></pre></div><p>Some distributions also offer Ansible as a package. You can also install Ansible directly with Homebrew for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install ansible
</span></span></code></pre></div><p>It is hoverer recommended to stick with one strategy. Installing Ansible with the systems package manager as well as pip will end up confusing your system since the same application has been installed twice.</p><p>Ansible is also not available for the Windows Operating System although there is a Python interpreter available for Windows. The application will not run on Windows because it makes use of functions that are only available on Posix-compliant systems like Linux and macOS. A solution to this problem is to run Ansible on top of Windows Subsystem for Linux or Cygwin.</p><h2 id=using-ansible-vault>Using Ansible Vault<a hidden class=anchor aria-hidden=true href=#using-ansible-vault>#</a></h2><p>As you can see in the earlier code example, we define a <code>mariadb_user</code> and <code>mariadb_password</code> variable. It’s not the best idea to leave passwords in plaintext because inventory files are often kept in version control solutions such as Git. These solutions are not made with access control in mind. Anyone with access to the repository will be able to see the password and use it to log in on the database.</p><p>A solution to this problem is to encrypt the password with Ansible Vault. This solution is built into Ansible and requires no additional software. Ansible Vault can encrypt whole files or strings of text (inline).</p><p>Inline encryption is the easiest. Open up a command prompt and execute the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-vault encrypt_string --ask-vault-password --encrypt-vault-id default
</span></span></code></pre></div><p>The tool will prompt you for a vault password used to encrypt the string and will then allow you to type the string to encrypt. Press <em>Crtl+D</em> when you are done typing the string. Ansible Vault will then print the encrypted multiline string. You can paste this string into your YAML file. Here is an example of what this looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>databases</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mariadb</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vars</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>mariadb_user</span>: <span style=color:#ae81ff>admin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mariadb_password</span>: !<span style=color:#ae81ff>vault |</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>$ANSIBLE_VAULT;1.1;AES256</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>313764333530363435666238313764343063353461613332623538663134663561</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>34363532303933393261623863663661310a613739316339346432613639383034</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>363038396634633261343333316466643366336565373335663065656465323166</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>61340a633039363737383934363439653932626466366665386362616363363639</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>6439</span>
</span></span></code></pre></div><p>As you can see, the value of the <code>mariadb_password</code> variable has been replaced with an Ansible Vault encryption block.</p><p>You might have noticed that apart from the <code>--ask-vault-password</code> option, we also need to supply the <code>--encrypt-vault-id</code> option with the value of <code>default</code>. Ansible Vault allows you to use multiple separate vaults in your inventory. You can for example have a “production” vault for all the production credentials and a “test” vault for all the test credentials. “default” is the name of the standard vault used by Ansible.</p><p>A similar process can be followed to encrypt a whole file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-vault create --ask-vault-password --encrypt-vault-id default vault.yml
</span></span></code></pre></div><p>You can edit your existing vault file by replacing ‘create’ with ‘edit’ in the command shown above. It is recommended to use placeholder variables when working with vault files. I will show you the contents of a main and vault file to show you what I mean:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>main.yml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>mariadb_address</span>: <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mariadb_port</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mariadb_user</span>: <span style=color:#ae81ff>admin</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mariadb_password</span>: <span style=color:#e6db74>&#34;{{ vault_mariadb_password }}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>vault.yml (decrypted)</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>vault_mariadb_password</span>: <span style=color:#ae81ff>password</span>
</span></span></code></pre></div><p>This way of working allows you to easily see which variables have been configured without the need to decrypt the <code>vault.yml</code> file. Note that the above example shows you the decrypted version of <code>vault.yml</code>. The encrypted version should look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>$ANSIBLE_VAULT;1.1;AES256
</span></span><span style=display:flex><span>38396432316565653734316563373234653338616561663263343339373933616238373334333331
</span></span><span style=display:flex><span>6663636437616538336663396564393731623966323037340a376363636438346564306536396539
</span></span><span style=display:flex><span>35646637363039383733353132623062306361633937343561343238616338646637353233386434
</span></span><span style=display:flex><span>3130386433346436340a623266653333373366653530343864333632663233313630613137366133
</span></span><span style=display:flex><span>65633065303434356239643566666236613733316536646630643133646636373437376365346462
</span></span><span style=display:flex><span>3331326361633337653934326361656136656239633230303533
</span></span></code></pre></div><p>Having to copy and paste the vault password into the terminal window each time you need to use Ansible Vault can be quite a pain. It’s also not wise from a security perspective since you could paste the password into the wrong window by accident. A solution to this problem is to use a password script instead.</p><p>Ansible allows you to supply it with a file path where it should read the password from. You can do this by using the <code>--vault-password-file</code> option instead of the <code>--ask-vault-password</code> option. Here is an example of how to do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;password&#39;</span> &gt; default
</span></span><span style=display:flex><span>ansible-vault encrypt_string --vault-password-file default --encrypt-vault-id default
</span></span></code></pre></div><p>You can store the password in a plaintext file but Ansible can also work with script. You can easily create a script that prints the password like the following example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>pass show infra/ansible/vault@default
</span></span></code></pre></div><p>This bash script loads the vault password from Pass. This solution is safer since the password is not saved in plaintext. Don’t forget to give the file execution permissions otherwise Ansible won’t be able to execute it and will interpret it as a plaintext file.</p><h2 id=using-pass-with-ansible>Using Pass with Ansible<a hidden class=anchor aria-hidden=true href=#using-pass-with-ansible>#</a></h2><p>You can also choose to pull credentials from an external source such as the Pass password manager. You can use this by using a lookup plugin. The pass lookup plugin is shipped with Ansible so there is no need to install any additional software.</p><p>Here is an example of how to use it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>mariadb_user</span>: <span style=color:#ae81ff>admin</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mariadb_password</span>: <span style=color:#e6db74>&#34;{{ lookup(&#39;pass&#39;, &#39;infra/production/admin@db1.example.com&#39;) }}&#34;</span>
</span></span></code></pre></div><p>You can use lookup plugins with the <code>lookup</code> function. The first argument of this function will always be the name of the plugin you wish to use. The rest of the arguments are passed to the plugin.</p><p>Accessing credentials like this can be useful if you want to have access to credentials from multiple tools. You can for example load the credentials into a Bash or Python script in order to connect to the database to do some maintenance work.</p><h2 id=managing-privileges>Managing privileges<a hidden class=anchor aria-hidden=true href=#managing-privileges>#</a></h2><p>Making changes to an operating system such as Linux or Windows usually requires administrative privileges. You can tell Ansible for which tasks it should use admin privileges by using the become option. Here is an example of what I mean:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure that the Python package is installed</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.package</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>python3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span></code></pre></div><p>The <code>become: yes</code> option instructs Ansible to use admin privileges, also referred to as ‘sudo privileges’ in the Linux world, to install the python3 package since a regular user is not allowed to install packages on a system.</p><p>You will have to ensure that the user account that is used by Ansible has sudo privileges. This can usually be achieved by adding the user to a certain group. Using the sudo command requires the user password by default on many systems. You can supply this password to Ansible by including the <code>--ask-become-pass</code> switch into your playbook command.</p><h2 id=running-a-playbook>Running a playbook<a hidden class=anchor aria-hidden=true href=#running-a-playbook>#</a></h2><p>I have now explained how to set everything up but you might wonder how to actually execute an Ansible playbook run. You can execute a run with the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-playbook --inventory inventory.ini play.yml
</span></span></code></pre></div><p>Here we tell Ansible which inventory and playbook to use for execution. Your roles should be located in a folder called ‘roles’. There is no option to set the roles path from the commandline but you can set a custom role path by using the <code>ansible.cfg</code> configuration file.</p><p>To do this, simply create a new file called <code>ansible.cfg</code> in your inventory directory with the following content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>roles_path = $HOME/Documents/ansible-roles
</span></span></code></pre></div><p>Change the path value to any value you would like. You can configure far more things in the configuration file than you can with commandline options. You can generate a full configuration file by using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-config init --disabled &gt; ansible.cfg
</span></span></code></pre></div><p>Feel free to use this file as a starting point for your own custom configuration. Remove the semicolon in front of a particular option to make it active.</p><h2 id=closing-words>Closing words<a hidden class=anchor aria-hidden=true href=#closing-words>#</a></h2><p>There is much more I can tell you about Ansible but I believe this is enough to get you started. This blog post will be the last post of the OpSec Series. It also acts as a bridge to my next series of blog posts which will focus more on Infrastructure as Code (IaC).</p><p>My goal with this new blog series is to give people a standardized and structured approach for deploying infrastructure in cloud and on-premise environments. I will mainly explain how IaC tools like Ansible, Terraform and Packer work and how they can be used effectively.</p><p>It has been about a year ago when I started this blog series and it has been an interesting journey. I often overestimated the time I needed to finish a blog post and always wanted them to be as complete as possible. Writing these blog posts has been a good tool to organize my knowledge and experiences. It is something that I want to continue to do.</p><p>I guess that’s all I wanted to say. Have a good day. See you at my blog post series (or not if IaC does not interest you).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.vharmers.com/tags/opsec/>Opsec</a></li><li><a href=https://www.vharmers.com/tags/macos/>Macos</a></li><li><a href=https://www.vharmers.com/tags/linux/>Linux</a></li><li><a href=https://www.vharmers.com/tags/iac/>Iac</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec Series - System Management on x" href="https://x.com/intent/tweet/?text=The%20OpSec%20Series%20-%20System%20Management&amp;url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_system_mgnt%2f&amp;hashtags=opsec%2cmacos%2clinux%2ciac"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec Series - System Management on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_system_mgnt%2f&amp;title=The%20OpSec%20Series%20-%20System%20Management&amp;summary=The%20OpSec%20Series%20-%20System%20Management&amp;source=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_system_mgnt%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec Series - System Management on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_system_mgnt%2f&title=The%20OpSec%20Series%20-%20System%20Management"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The OpSec Series - System Management on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.vharmers.com%2fposts%2fopsec_system_mgnt%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.vharmers.com/>Valentine's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>